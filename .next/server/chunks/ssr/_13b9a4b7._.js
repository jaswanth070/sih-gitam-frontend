module.exports=[84120,4532,a=>{"use strict";var b=a.i(11634);let c="http://127.0.0.1:8001",d=`${c}/requests/api`;function e(a){let b=a.replace(/\/+$/,"");return b?(b.startsWith("/")||(b=`/${b}`),b.endsWith("/requests/api"))?b:b.endsWith("/requests")?`${b}/api`:b.endsWith("/api")?b.replace(/\/api$/,"/requests/api"):`${b}/requests/api`:"/requests/api"}function f(a){let b=e(a);return"/requests/api"===b?"/requests":b.replace(/\/api$/,"")||"/requests"}function g(){let a="https://sih.jaswanthmadiya.tech/requests/";if(a.startsWith("/"))return e(a);try{let b=new URL(a);return b.pathname=e(b.pathname),`${b.origin}${b.pathname}`}catch(a){return console.warn("[ws-url] invalid NEXT_PUBLIC_REQUESTS_SERVICE_URL, using default",a),d}}function h(a){try{let b=new URL("wss://sih.jaswanthmadiya.tech/ws/requests");return b.searchParams.set("token",a),b.toString()}catch(a){console.warn("[ws-url] invalid NEXT_PUBLIC_REQUESTS_WS_URL, falling back",a)}let b="https://sih.jaswanthmadiya.tech/requests/",d="",e="/requests";if(b.startsWith("http"))try{let a=new URL(b);d=a.origin,e=f(a.pathname)}catch(a){console.warn("[ws-url] invalid NEXT_PUBLIC_REQUESTS_SERVICE_URL, using defaults",a)}else e=f(b);d||(d=c);let g=d.startsWith("https://"),h=d.replace(/^https?:\/\//,""),i=`${e}/ws/requests/`;return(i=i.replace(/\/+/g,"/")).startsWith("/")||(i=`/${i}`),`${g?"wss":"ws"}://${h}${i}?token=${encodeURIComponent(a)}`}a.s(["buildRequestsBaseUrl",()=>g,"buildRequestsWsUrl",()=>h],4532);let i=g();async function j(a,c={}){let d=`${i}${a}`,e=new Headers(c.headers||{}),f=b.authService.getAccessToken();f&&!e.has("Authorization")&&e.set("Authorization",`Bearer ${f}`);let g=await fetch(d,{...c,headers:e});if(401===g.status){let a=b.authService.getRefreshToken();if(a)try{let b=await fetch(`${i}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:a})});if(b.ok){let{access:a}=await b.json();localStorage.setItem("sih_access_token",a),e.set("Authorization",`Bearer ${a}`),g=await fetch(d,{...c,headers:e})}}catch(a){b.authService.clearTokens(),window.location.href="/login"}}if(!g.ok){let a=await g.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${g.status}`)}return g.json()}a.s(["requestsService",0,{async listRequests(a){let b=new URLSearchParams;return a?.category&&b.append("category",a.category),a?.status&&b.append("status",a.status),a?.fab_type&&b.append("fab_type",a.fab_type),a?.team_id&&b.append("team_id",a.team_id),a?.search&&b.append("search",a.search),a?.ordering&&b.append("ordering",a.ordering),a?.page&&b.append("page",a.page.toString()),j(`/requests/?${b.toString()}`)},getQueueSnapshot:async(a=!0)=>j(`/requests/queue/?include_positions=${a}`),async getFilteredQueueSnapshot(a){let b=new URLSearchParams;return a.category&&b.append("category",a.category),a.status&&b.append("status",a.status),a.fab_type&&b.append("fab_type",a.fab_type),void 0!==a.include_positions&&b.append("include_positions",a.include_positions?"true":"false"),a.page&&b.append("page",a.page.toString()),a.page_size&&b.append("page_size",a.page_size.toString()),j(`/requests/queue/?${b.toString()}`)},getRequest:async a=>j(`/requests/${a}/`),createBOMRequest:async(a,b,c)=>j("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,category:"BOM",notes:b,bom_items:c})}),createAdditionalRequest:async(a,b,c)=>j("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,category:"ADDITIONAL",notes:b,additional_items:c})}),async createFabricationRequest(a,c,d,e){let f=new FormData;f.append("team_id",a),f.append("category","FABRICATION"),f.append("notes",c),f.append("fabrication",JSON.stringify(d)),e&&f.append("file",e);let g=b.authService.getAccessToken(),h=new Headers;g&&h.set("Authorization",`Bearer ${g}`);let j=await fetch(`${i}/requests/`,{method:"POST",headers:h,body:f});if(!j.ok){let a=await j.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${j.status}`)}return j.json()},changeRequestStatus:async(a,b,c,d)=>j(`/requests/${a}/change_status/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_status:b,note:c||"",...void 0!==d?{remarks:d}:{}})}),async listTeamRequests(a,b){let c=new URLSearchParams;return b?.category&&c.append("category",b.category),b?.status&&c.append("status",b.status),b?.fab_type&&c.append("fab_type",b.fab_type),b?.search&&c.append("search",b.search),b?.ordering&&c.append("ordering",b.ordering),b?.page&&c.append("page",b.page.toString()),b?.page_size&&c.append("page_size",b.page_size.toString()),j(`/teams/${a}/requests/${c.toString()?`?${c.toString()}`:""}`)}}],84120)},93107,a=>{"use strict";var b=a.i(46447),c=a.i(30564);let d=["Submitted","Processing","Issued"];function e({status:a}){return(0,b.jsx)("div",{className:"flex items-center gap-2","aria-label":"Request status progress",children:d.map((e,f)=>{let g=d.indexOf(a),h=g>=f;return(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsxs)("div",{className:`flex flex-col items-center text-[10px] font-medium ${h?"text-[#002449]":"text-gray-400"}`,children:[(0,b.jsx)("div",{className:`h-2.5 w-2.5 rounded-full ${h?g===f?"bg-[#f75700]":"bg-[#002449]":"bg-gray-300"}`}),(0,b.jsx)("span",{className:"mt-1 tracking-wide",children:e})]}),f<d.length-1&&(0,b.jsx)("div",{className:`h-px w-6 ${g>f?"bg-[#002449]":"bg-gray-300"}`,"aria-hidden":"true"})]},e)})})}a.s(["RequestProgress",()=>e])},72609,a=>{"use strict";var b=a.i(46447),c=a.i(30564);function d({open:a,currentStatus:d,targetStatus:e,onClose:f,onConfirm:g,loading:h=!1}){let[i,j]=(0,c.useState)("");(0,c.useEffect)(()=>{a&&j("")},[a,d,e]);let k=(0,c.useMemo)(()=>"Cannot be Processed"===e||"Processing"===d&&"Issued"===e,[d,e]);return a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,b.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-white p-6 shadow-xl animate-in fade-in slide-in-from-bottom",children:[(0,b.jsx)("h2",{className:"mb-4 text-lg font-semibold",style:{color:"#002449"},children:"Confirm Status Update"}),(0,b.jsxs)("div",{className:"mb-4 space-y-2 text-sm",children:[(0,b.jsxs)("p",{className:"text-gray-600",children:["You are changing the request from ",(0,b.jsx)("span",{className:"font-semibold",children:d})," to "," ",(0,b.jsx)("span",{className:"font-semibold",children:e}),"."]}),(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:k?"A remark for the team is required before you continue.":"Review the update and confirm when ready."})]}),k&&(0,b.jsxs)("div",{className:"mb-5 space-y-2",children:[(0,b.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Remarks for Team (required)"}),(0,b.jsx)("textarea",{value:i,onChange:a=>j(a.target.value),placeholder:"Share any guidance or context for the team.",className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#f75700]/40",rows:3}),(0,b.jsx)("p",{className:"text-[11px] text-gray-500",children:"These remarks are visible to the team on their dashboard and request view."})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:f,disabled:h,className:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,b.jsx)("button",{type:"button",onClick:()=>g(i.trim()||void 0),disabled:h,className:"flex-1 rounded-lg bg-[#f75700] px-4 py-2 text-sm font-semibold text-white transition hover:bg-[#f75700]/90 disabled:cursor-not-allowed disabled:opacity-60",children:h?"Updating...":"Confirm"})]})]})}):null}a.s(["StatusChangeModal",()=>d])},80080,a=>{"use strict";var b=a.i(46447),c=a.i(30564),d=a.i(1470),e=a.i(11634),f=a.i(84120),g=a.i(72609),h=a.i(93107);function i(){var a;let i=(0,d.useRouter)(),m=(0,d.useParams)().id,[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),x=e.authService.getCurrentUser();(0,c.useEffect)(()=>{if(!e.authService.getAccessToken())return void i.push("/login")},[i]),(0,c.useEffect)(()=>{(async()=>{try{q(!0);let a=await f.requestsService.getRequest(Number.parseInt(m));o(a)}catch(a){console.error("[v0] Error fetching request:",a),s(a instanceof Error?a.message:"Failed to load request")}finally{q(!1)}})()},[m]);let y=(0,c.useCallback)((a,b)=>"Cannot be Processed"===b||"Processing"===a&&"Issued"===b,[]),z=(0,c.useCallback)(async(a,b)=>{if(n)try{u(!0);let c=await f.requestsService.changeRequestStatus(n.id,a,`Status changed to ${a}`,b);o(c),w(null)}catch(a){s(a instanceof Error?a.message:"Failed to update status")}finally{u(!1)}},[n]),A=(0,c.useCallback)(a=>{if(n){if(y(n.status,a))return void w(a);z(a)}},[z,n,y]);if(p)return(0,b.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"mx-auto mb-4 h-10 w-10 animate-spin rounded-full border-4 border-gray-300 border-t-[#f75700]"}),(0,b.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading request..."})]})});if(!n)return(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:r||"Request not found"})});let B=x?.is_poc||x?.is_admin,C="Submitted"===n.status?["Processing","Cannot be Processed"]:"Processing"===n.status?["Issued","Cannot be Processed"]:[],D=j(n.status),E=`${D}1a`,F=`linear-gradient(135deg, ${E} 0%, #ffffff 65%)`,G=n.notes.trim().length>0?n.notes:n.description&&n.description.trim().length>0?n.description:"Request",H=n.description&&n.description.trim().length>0?n.description:n.notes.trim().length>0?n.notes:"No additional details were provided.",I=new Date(n.created_at).toLocaleString(),J=new Date(n.updated_at).toLocaleString(),K=n.position?`#${n.position}`:"--",L=n.team_name||"Unassigned Team";return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mx-auto max-w-6xl space-y-8 pb-12",children:[r&&(0,b.jsx)("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-4 shadow-sm",children:(0,b.jsx)("p",{className:"text-sm text-red-800",children:r})}),(0,b.jsxs)("section",{className:"relative overflow-hidden rounded-3xl border border-gray-200 bg-white shadow-xl",children:[(0,b.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:F}}),(0,b.jsxs)("div",{className:"relative space-y-6 p-8 md:p-12",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,b.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold text-white",style:{backgroundColor:"BOM"===(a=n.category)?"#002449":"ADDITIONAL"===a?"#007367":"#f75700"},children:n.category}),(0,b.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold text-white",style:{backgroundColor:j(n.status)},children:n.status})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 md:text-4xl",children:G}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-gray-600",children:[(0,b.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"uppercase tracking-wide text-gray-500",children:"Request"}),(0,b.jsxs)("span",{className:"text-gray-900",children:["#",n.id]})]}),(0,b.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"uppercase tracking-wide text-gray-500",children:"Team"}),(0,b.jsx)("span",{className:"text-gray-900",children:L})]}),(0,b.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 shadow-sm",children:[(0,b.jsx)("span",{className:"uppercase tracking-wide text-gray-500",children:"Queue"}),(0,b.jsx)("span",{className:"text-gray-900",children:K})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-4 rounded-2xl border border-white/60 bg-white/70 px-4 py-3 shadow-inner",children:[(0,b.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Progress"}),(0,b.jsx)(h.RequestProgress,{status:n.status})]}),(0,b.jsxs)("div",{className:"grid gap-4 text-xs font-semibold text-gray-700 sm:grid-cols-2 lg:grid-cols-4",children:[(0,b.jsx)(k,{label:"Created",value:I}),(0,b.jsx)(k,{label:"Updated",value:J}),(0,b.jsx)(k,{label:"Category",value:n.category}),(0,b.jsx)(k,{label:"Status",value:n.status})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(l,{title:"Overview",children:(0,b.jsx)("p",{className:"whitespace-pre-line text-sm leading-relaxed text-gray-700",children:H})}),n.remarks&&(0,b.jsx)(l,{title:"Team Remarks",children:(0,b.jsxs)("div",{className:"rounded-xl border border-orange-200 bg-orange-50 px-4 py-4 text-sm text-gray-800 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#f75700]",children:"Latest Remark"}),(0,b.jsx)("p",{className:"mt-2 whitespace-pre-line leading-relaxed",children:n.remarks})]})}),n.bom_items&&n.bom_items.length>0&&(0,b.jsx)(l,{title:"BOM Items",children:(0,b.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-100",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-100 text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Item Name"}),(0,b.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Qty"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-100 bg-white",children:n.bom_items.map((a,c)=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-2 text-sm font-medium text-gray-800",children:a.item_name}),(0,b.jsx)("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:a.quantity})]},c))})]})})}),n.additional_items&&n.additional_items.length>0&&(0,b.jsx)(l,{title:"Additional Items",children:(0,b.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-100",children:(0,b.jsxs)("table",{className:"min-w-full divide-y divide-gray-100 text-sm",children:[(0,b.jsx)("thead",{className:"bg-gray-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Item Name"}),(0,b.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Qty"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-gray-100 bg-white",children:n.additional_items.map((a,c)=>(0,b.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-4 py-2 text-sm font-medium text-gray-800",children:a.item_name}),(0,b.jsx)("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:a.quantity})]},c))})]})})}),n.fabrication&&(0,b.jsxs)(l,{title:"Fabrication Details",children:[(0,b.jsxs)("div",{className:"grid gap-3 text-sm sm:grid-cols-2",children:[(0,b.jsx)(k,{label:"Type",value:n.fabrication.fab_type}),(0,b.jsx)(k,{label:"Name",value:n.fabrication.name})]}),n.fabrication.file&&(0,b.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Attachment"}),(0,b.jsx)("a",{href:n.fabrication.file,target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-[#002449]/20 bg-[#002449]/5 px-3 py-2 text-sm font-semibold text-[#002449] transition hover:bg-[#002449]/10",children:"Download fabrication file"})]})]})]}),(0,b.jsxs)("aside",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold text-[#002449]",children:"Key Details"}),(0,b.jsxs)("dl",{className:"mt-4 space-y-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Request ID"}),(0,b.jsxs)("dd",{className:"text-sm font-semibold text-gray-900",children:["#",n.id]})]}),(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Team"}),(0,b.jsx)("dd",{className:"max-w-[12rem] text-right text-sm font-semibold text-gray-900",children:L})]}),(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Queue Position"}),(0,b.jsx)("dd",{className:"text-sm font-semibold text-gray-900",children:K})]}),(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Created"}),(0,b.jsx)("dd",{className:"max-w-[12rem] text-right text-sm font-semibold text-gray-900",children:I})]}),(0,b.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,b.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Updated"}),(0,b.jsx)("dd",{className:"max-w-[12rem] text-right text-sm font-semibold text-gray-900",children:J})]})]})]}),B&&C.length>0&&(0,b.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold text-[#f75700]",children:"Update Status"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Choose the next stage for this request. You can add remarks to guide the team before confirming."}),(0,b.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:C.map(a=>(0,b.jsx)("button",{onClick:()=>A(a),disabled:t,className:"rounded-lg px-4 py-2 text-xs font-semibold text-white shadow-sm transition disabled:cursor-not-allowed disabled:opacity-70",style:{backgroundColor:"Cannot be Processed"===a?"#f75700":"#078e31"},children:t?"Updating...":"Cannot be Processed"===a?"Reject":`Mark ${a}`},a))})]})]})]})]}),n&&v&&(0,b.jsx)(g.StatusChangeModal,{open:!!v,currentStatus:n.status,targetStatus:v,loading:t,onClose:()=>w(null),onConfirm:async a=>{await z(v,a)}})]})}function j(a){return"Submitted"===a?"#f75700":"Processing"===a?"#002449":"Issued"===a?"#078e31":"#6b7280"}function k({label:a,value:c}){return(0,b.jsxs)("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[(0,b.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:a}),(0,b.jsx)("p",{className:"mt-2 text-sm font-semibold text-gray-900 break-words",children:c})]})}function l({title:a,children:c}){return(0,b.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h2",{className:"text-base font-semibold text-[#002449]",children:a}),(0,b.jsx)("div",{className:"mt-4 space-y-4",children:c})]})}a.s(["default",()=>i])}];

//# sourceMappingURL=_13b9a4b7._.js.map