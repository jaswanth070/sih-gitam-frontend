{"version":3,"sources":["../../../../lib/session-store.ts","../../../../lib/auth-service.ts","../../../../lib/requests-service.ts","../../../../lib/ws-url.ts","../../../../components/requests/request-progress.tsx","../../../../components/modals/status-change-modal.tsx"],"sourcesContent":["import type { AdminTeamSummary, CurrentUser, POCTeam, TeamDetails } from \"./auth-service\"\r\n\r\nconst SESSION_KEY = \"sih_session_cache_v1\"\r\n\r\ntype SessionPayload = {\r\n  currentUser?: CurrentUser | null\r\n  leaderTeam?: TeamDetails | null\r\n  pocTeams?: POCTeam[]\r\n  pocTeamDetails?: Record<string, TeamDetails>\r\n  adminTeams?: AdminTeamSummary[]\r\n  updatedAt?: number\r\n}\r\n\r\nfunction isBrowser(): boolean {\r\n  return typeof window !== \"undefined\" && typeof window.localStorage !== \"undefined\"\r\n}\r\n\r\nfunction readSession(): SessionPayload {\r\n  if (!isBrowser()) return {}\r\n  try {\r\n    const raw = window.localStorage.getItem(SESSION_KEY)\r\n    if (!raw) return {}\r\n    const parsed = JSON.parse(raw) as SessionPayload\r\n    return parsed ?? {}\r\n  } catch (error) {\r\n    console.warn(\"[session-store] Failed to parse session payload\", error)\r\n    return {}\r\n  }\r\n}\r\n\r\nfunction writeSession(payload: SessionPayload): void {\r\n  if (!isBrowser()) return\r\n  try {\r\n    const serialized = JSON.stringify({ ...payload, updatedAt: Date.now() })\r\n    window.localStorage.setItem(SESSION_KEY, serialized)\r\n  } catch (error) {\r\n    console.warn(\"[session-store] Failed to persist session payload\", error)\r\n  }\r\n}\r\n\r\nfunction mergeSession(partial: Partial<SessionPayload>): SessionPayload {\r\n  const existing = readSession()\r\n  const next: SessionPayload = {\r\n    ...existing,\r\n    ...partial,\r\n  }\r\n  writeSession(next)\r\n  return next\r\n}\r\n\r\nexport function clearSessionCache(): void {\r\n  if (!isBrowser()) return\r\n  window.localStorage.removeItem(SESSION_KEY)\r\n}\r\n\r\nexport function storeCurrentUser(user: CurrentUser | null): void {\r\n  mergeSession({ currentUser: user })\r\n}\r\n\r\nexport function getStoredCurrentUser(): CurrentUser | null {\r\n  const session = readSession()\r\n  return session.currentUser ?? null\r\n}\r\n\r\nexport function storeLeaderTeam(team: TeamDetails | null): void {\r\n  mergeSession({ leaderTeam: team })\r\n}\r\n\r\nexport function getStoredLeaderTeam(): TeamDetails | null {\r\n  const session = readSession()\r\n  return session.leaderTeam ?? null\r\n}\r\n\r\nexport function storePOCTeams(teams: POCTeam[]): void {\r\n  mergeSession({ pocTeams: teams })\r\n}\r\n\r\nexport function getStoredPOCTeams(): POCTeam[] {\r\n  const session = readSession()\r\n  return Array.isArray(session.pocTeams) ? session.pocTeams : []\r\n}\r\n\r\nexport function storePOCTeamDetail(team: TeamDetails): void {\r\n  if (!team?.id) return\r\n  const session = readSession()\r\n  const nextDetails = { ...(session.pocTeamDetails ?? {}), [team.id]: team }\r\n  mergeSession({ pocTeamDetails: nextDetails })\r\n}\r\n\r\nexport function getStoredPOCTeamDetail(teamId: string | null | undefined): TeamDetails | null {\r\n  if (!teamId) return null\r\n  const session = readSession()\r\n  const lookup = session.pocTeamDetails ?? {}\r\n  return lookup[teamId] ?? null\r\n}\r\n\r\nexport function storeAdminTeams(teams: AdminTeamSummary[]): void {\r\n  mergeSession({ adminTeams: teams })\r\n}\r\n\r\nexport function getStoredAdminTeams(): AdminTeamSummary[] {\r\n  const session = readSession()\r\n  return Array.isArray(session.adminTeams) ? session.adminTeams : []\r\n}\r\n\r\nexport function getSessionSnapshot(): SessionPayload {\r\n  return readSession()\r\n}\r\n","/**\n * Auth Service API Client\n * Handles all authentication-related API calls with secure token management\n */\n\nimport {\n  clearSessionCache,\n  getStoredAdminTeams,\n  getStoredLeaderTeam,\n  getStoredPOCTeamDetail,\n  getStoredPOCTeams,\n  storeAdminTeams,\n  storeCurrentUser,\n  storeLeaderTeam,\n  storePOCTeamDetail,\n  storePOCTeams,\n} from \"./session-store\"\n\nconst ACCESS_TOKEN_KEY = \"sih_access_token\"\nconst REFRESH_TOKEN_KEY = \"sih_refresh_token\"\nconst FALLBACK_AUTH_BASE_URL = \"http://127.0.0.1:8000/auth/api\"\n\nfunction normalizeAuthPath(pathname: string): string {\n  let normalized = pathname.replace(/\\/+$/, \"\")\n  if (!normalized) return \"/auth/api\"\n  if (!normalized.startsWith(\"/\")) normalized = `/${normalized}`\n  if (normalized.endsWith(\"/auth/api\")) return normalized\n  if (normalized.endsWith(\"/auth\")) return `${normalized}/api`\n  if (normalized.endsWith(\"/api\")) return normalized\n  return `${normalized}/auth/api`\n}\n\nexport function buildAuthBaseUrl(): string {\n  const raw = process.env.NEXT_PUBLIC_AUTH_SERVICE_URL\n  if (!raw) return FALLBACK_AUTH_BASE_URL\n\n  if (raw.startsWith(\"/\")) {\n    return normalizeAuthPath(raw)\n  }\n\n  try {\n    const url = new URL(raw)\n    url.pathname = normalizeAuthPath(url.pathname)\n    return `${url.origin}${url.pathname}`\n  } catch (err) {\n    console.warn(\"[auth-service] invalid NEXT_PUBLIC_AUTH_SERVICE_URL, using default\", err)\n    return FALLBACK_AUTH_BASE_URL\n  }\n}\n\nconst BASE_URL = buildAuthBaseUrl()\n\nexport interface LoginRequest {\n  email: string\n  password: string\n}\n\nexport interface LoginResponse {\n  access: string\n  refresh: string\n}\n\nexport interface OTPRequest {\n  email: string\n  purpose: string\n}\n\nexport interface OTPVerifyRequest {\n  email: string\n  otp: string\n  new_password: string\n}\n\nexport interface RefreshTokenRequest {\n  refresh: string\n}\n\nexport interface RefreshTokenResponse {\n  access: string\n}\n\nexport interface LogoutRequest {\n  refresh: string\n}\n\nexport interface TeamContact {\n  id: string\n  name?: string | null\n  email?: string | null\n  phone?: string | null\n  designation?: string | null\n  role?: string | null\n  gender?: string | null\n  first_login?: boolean\n  is_verified_poc?: boolean\n}\n\nexport interface TeamMemberSummary {\n  id: string\n  role: string\n  phone?: string | null\n  gender?: string | null\n  user: {\n    id: string\n    email: string\n    name: string\n  }\n}\n\nexport interface ProblemStatementSummary {\n  id: string\n  title?: string | null\n  description?: string | null\n}\n\nexport interface TeamDetails {\n  id: string\n  team_id: string\n  name: string\n  institution: string\n  poc: TeamContact | null\n  faculty_mentor?: TeamContact | null\n  faculty_mentor_1?: TeamContact | null\n  faculty_mentor_2?: TeamContact | null\n  mentors?: TeamContact[]\n  problem_statement?: ProblemStatementSummary | null\n  members: TeamMemberSummary[]\n  [key: string]: any\n}\n\nexport interface POCTeam {\n  id: string\n  name: string\n  institution: string\n  [key: string]: any\n}\n\nexport interface AdminTeamSummary extends TeamDetails {\n  status?: string\n}\n\nexport interface CurrentUser {\n  id?: string\n  email?: string\n  name?: string\n  team_ids?: string[]\n  role?: string\n  is_admin?: boolean\n  is_poc?: boolean\n  is_leader?: boolean\n  [key: string]: any\n}\n\nclass AuthService {\n  private accessTokenKey = ACCESS_TOKEN_KEY\n  private refreshTokenKey = REFRESH_TOKEN_KEY\n\n  private setTokens(access: string, refresh: string) {\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(this.accessTokenKey, access)\n      localStorage.setItem(this.refreshTokenKey, refresh)\n    }\n  }\n\n  getAccessToken(): string | null {\n    if (typeof window !== \"undefined\") {\n      return localStorage.getItem(this.accessTokenKey)\n    }\n    return null\n  }\n\n  getRefreshToken(): string | null {\n    if (typeof window !== \"undefined\") {\n      return localStorage.getItem(this.refreshTokenKey)\n    }\n    return null\n  }\n\n  clearTokens() {\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(this.accessTokenKey)\n      localStorage.removeItem(this.refreshTokenKey)\n    }\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}, retryCount = 0): Promise<T> {\n    const url = `${BASE_URL}${endpoint}`\n    const headers = new Headers(options.headers || {})\n\n    const accessToken = this.getAccessToken()\n    if (accessToken) {\n      headers.set(\"Authorization\", `Bearer ${accessToken}`)\n    }\n\n    const response = await fetch(url, {\n      ...options,\n      headers,\n    })\n\n    if (response.status === 401 && retryCount === 0) {\n      const refreshToken = this.getRefreshToken()\n      if (refreshToken) {\n        try {\n          const newAccessToken = await this.refreshAccessToken(refreshToken)\n          return this.request<T>(endpoint, options, 1)\n        } catch (error) {\n          this.clearTokens()\n          if (typeof window !== \"undefined\") {\n            window.location.href = \"/login\"\n          }\n          throw new Error(\"Session expired. Please login again.\")\n        }\n      }\n    }\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({}))\n      throw new Error(error.detail || error.message || `API Error: ${response.status}`)\n    }\n\n    return response.json()\n  }\n\n  getCurrentUser(): CurrentUser | null {\n    if (typeof window === \"undefined\") return null\n    const token = this.getAccessToken()\n    if (!token) return null\n\n    try {\n      const [, payload] = token.split(\".\")\n      if (!payload) return null\n      const json = JSON.parse(this.base64UrlDecode(payload))\n      return json as CurrentUser\n    } catch (e) {\n      return null\n    }\n  }\n\n  private base64UrlDecode(input: string): string {\n    // Convert from base64url to base64\n    let base64 = input.replace(/-/g, \"+\").replace(/_/g, \"/\")\n    // Pad with '=' to make length a multiple of 4\n    const pad = base64.length % 4\n    if (pad) base64 += \"=\".repeat(4 - pad)\n    if (typeof window !== \"undefined\" && typeof window.atob === \"function\") {\n      return decodeURIComponent(\n        Array.prototype.map\n          .call(window.atob(base64), (c: string) => \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2))\n          .join(\"\")\n      )\n    }\n    // Fallback for non-browser environments\n    return Buffer.from(base64, \"base64\").toString(\"utf-8\")\n  }\n\n  async login(request: LoginRequest): Promise<LoginResponse> {\n    const response = await this.request<LoginResponse>(\"/token/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    })\n\n    this.setTokens(response.access, response.refresh)\n    if (typeof window !== \"undefined\") {\n      this.initializeUserContext().catch((error: unknown) => {\n        console.warn(\"[auth-service] Failed to initialize session context\", error)\n      })\n    }\n    return response\n  }\n\n  private async refreshAccessToken(refreshToken: string): Promise<string> {\n    const response = await this.request<RefreshTokenResponse>(\"/token/refresh/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ refresh: refreshToken }),\n    })\n\n    const accessToken = response.access\n    localStorage.setItem(this.accessTokenKey, accessToken)\n    return accessToken\n  }\n\n  async requestOTP(email: string): Promise<{ detail: string }> {\n    return this.request(\"/auth/send-otp/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ email, purpose: \"first_login\" }),\n    })\n  }\n\n  async verifyOTPAndSetPassword(request: OTPVerifyRequest): Promise<{ detail: string; next: string }> {\n    return this.request(\"/auth/verify-otp/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    })\n  }\n\n  async autoLogin(email: string, password: string): Promise<LoginResponse> {\n    return this.login({ email, password })\n  }\n\n  async getTeamDetails(preview = false): Promise<TeamDetails> {\n    if (!preview) {\n      const cached = getStoredLeaderTeam()\n      if (cached) return cached\n    }\n    const endpoint = preview ? \"/leader/team/?preview=1\" : \"/leader/team/\"\n    const data = await this.request<TeamDetails>(endpoint)\n    if (!preview) {\n      storeLeaderTeam(data)\n    }\n    return data\n  }\n\n  async confirmTeamDetails(): Promise<{ detail: string; next: string }> {\n    return this.request(\"/leader/team/confirm/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({}),\n    })\n  }\n\n  async getPOCTeams(): Promise<POCTeam[]> {\n    const cached = getStoredPOCTeams()\n    if (cached.length) return cached\n    const data = await this.request<POCTeam[]>(\"/poc/teams/\")\n    storePOCTeams(data)\n    return data\n  }\n\n  async getPOCTeamDetail(teamId: string): Promise<TeamDetails> {\n    const cached = getStoredPOCTeamDetail(teamId)\n    if (cached) return cached\n    const data = await this.request<TeamDetails>(`/poc/teams/${teamId}/`)\n    storePOCTeamDetail(data)\n    return data\n  }\n\n  async getAdminTeams(): Promise<AdminTeamSummary[]> {\n    const cached = getStoredAdminTeams()\n    if (cached.length) return cached\n    const data = await this.request<AdminTeamSummary[]>(\"/admin/teams/\")\n    storeAdminTeams(data)\n    return data\n    // return this.request(\"/poc/teams/\")\n  }\n\n  async logout(): Promise<{ detail: string }> {\n    const refreshToken = this.getRefreshToken()\n    if (!refreshToken) {\n      this.clearTokens()\n      clearSessionCache()\n      return { detail: \"Logged out\" }\n    }\n\n    try {\n      const response = await this.request<{ detail: string }>(\"/auth/logout/\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ refresh: refreshToken }),\n      })\n      this.clearTokens()\n      clearSessionCache()\n      return response\n    } catch (error) {\n      this.clearTokens()\n      clearSessionCache()\n      return { detail: \"Logged out\" }\n    }\n  }\n\n  async logoutAll(): Promise<{ detail: string }> {\n    try {\n      const response = await this.request<{ detail: string }>(\"/auth/logout_all/\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      })\n      this.clearTokens()\n      clearSessionCache()\n      return response\n    } catch (error) {\n      this.clearTokens()\n      clearSessionCache()\n      return { detail: \"Logged out from all devices\" }\n    }\n  }\n\n  async initializeUserContext(force = false): Promise<void> {\n    if (typeof window === \"undefined\") return\n    const user = this.getCurrentUser()\n    if (!user) return\n\n    storeCurrentUser(user)\n\n    if (user.is_admin) {\n      if (!force && getStoredAdminTeams().length) return\n      try {\n        const teams = await this.request<AdminTeamSummary[]>(\"/admin/teams/\")\n        storeAdminTeams(teams)\n      } catch (error: unknown) {\n        console.warn(\"[auth-service] unable to cache admin teams\", error)\n      }\n      return\n    }\n\n    if (user.is_poc) {\n      if (!force && getStoredPOCTeams().length) return\n      try {\n        const teams = await this.request<POCTeam[]>(\"/poc/teams/\")\n        storePOCTeams(teams)\n        await Promise.all(\n          teams.map(async (team) => {\n            const teamKey = String(team.id)\n            if (getStoredPOCTeamDetail(teamKey)) return\n            try {\n              const detail = await this.request<TeamDetails>(`/poc/teams/${teamKey}/`)\n              storePOCTeamDetail(detail)\n            } catch (error: unknown) {\n              console.warn(`[auth-service] unable to cache POC team detail for ${teamKey}`, error)\n            }\n          }),\n        )\n      } catch (error: unknown) {\n        console.warn(\"[auth-service] unable to cache POC teams\", error)\n      }\n      return\n    }\n\n    if (!force && getStoredLeaderTeam()) return\n    try {\n      const team = await this.request<TeamDetails>(\"/leader/team/\")\n      storeLeaderTeam(team)\n    } catch (error: unknown) {\n      console.warn(\"[auth-service] unable to cache leader team\", error)\n    }\n  }\n}\n\nexport const authService = new AuthService()\n","/**\r\n * Requests Service API Client\r\n * Handles all communication with the Requests microservice\r\n */\r\n\r\nimport { authService } from \"./auth-service\"\r\nimport { buildRequestsBaseUrl } from \"./ws-url\"\r\n\r\nconst BASE_URL = buildRequestsBaseUrl()\r\nconst ACCESS_TOKEN_KEY = \"sih_access_token\"\r\n\r\nexport interface BOMItem {\r\n  id?: number\r\n  item_name: string\r\n  quantity: number\r\n}\r\n\r\nexport interface AdditionalItem {\r\n  id?: number\r\n  item_name: string\r\n  quantity: number\r\n}\r\n\r\nexport interface FabricationDetails {\r\n  fab_type: \"3D\" | \"LASER\" | \"OTHER\"\r\n  name: string\r\n  file?: string\r\n}\r\n\r\nexport interface RequestData {\r\n  id: number\r\n  team_id: string\r\n  team_name?: string\r\n  submitted_by_id: string\r\n  category: \"BOM\" | \"ADDITIONAL\" | \"FABRICATION\"\r\n  status: \"Submitted\" | \"Processing\" | \"Issued\" | \"Cannot be Processed\"\r\n  notes: string // legacy field; backend now may send `description`\r\n  description?: string\r\n  remarks?: string | null\r\n  created_at: string\r\n  updated_at: string\r\n  position?: number\r\n  bom_items: BOMItem[]\r\n  additional_items: AdditionalItem[]\r\n  fabrication: FabricationDetails | null\r\n}\r\n\r\nexport interface ListRequestsParams {\r\n  category?: \"BOM\" | \"ADDITIONAL\" | \"FABRICATION\"\r\n  status?: \"Submitted\" | \"Processing\" | \"Issued\" | \"Cannot be Processed\"\r\n  fab_type?: \"3D\" | \"LASER\" | \"OTHER\"\r\n  team_id?: string\r\n  search?: string\r\n  ordering?: string\r\n  page?: number\r\n}\r\n\r\nexport interface TeamRequestsParams {\r\n  category?: \"BOM\" | \"ADDITIONAL\" | \"FABRICATION\"\r\n  status?: \"Submitted\" | \"Processing\" | \"Issued\" | \"Cannot be Processed\"\r\n  fab_type?: \"3D\" | \"LASER\" | \"OTHER\"\r\n  search?: string\r\n  ordering?: string\r\n  page?: number\r\n  page_size?: number\r\n}\r\n\r\nexport interface RequestsListResponse {\r\n  count: number\r\n  next: string | null\r\n  previous: string | null\r\n  results: RequestData[]\r\n}\r\n\r\n// Queue snapshot response (includes explicit paging metadata and optional positions)\r\nexport interface QueueSnapshotResponse {\r\n  count: number\r\n  page: number\r\n  page_size: number\r\n  results: RequestData[]\r\n}\r\n\r\nexport interface QueueSnapshotParams {\r\n  category?: \"BOM\" | \"ADDITIONAL\" | \"FABRICATION\"\r\n  status?: \"Submitted\" | \"Processing\" | \"Issued\" | \"Cannot be Processed\"\r\n  fab_type?: \"3D\" | \"LASER\" | \"OTHER\"\r\n  include_positions?: boolean\r\n  page?: number\r\n  page_size?: number\r\n}\r\n\r\nasync function apiCall<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\r\n  const url = `${BASE_URL}${endpoint}`\r\n  const headers = new Headers(options.headers || {})\r\n\r\n  const accessToken = authService.getAccessToken()\r\n  if (accessToken && !headers.has(\"Authorization\")) {\r\n    headers.set(\"Authorization\", `Bearer ${accessToken}`)\r\n  }\r\n\r\n  let response = await fetch(url, {\r\n    ...options,\r\n    headers,\r\n  })\r\n\r\n  if (response.status === 401) {\r\n    const refreshToken = authService.getRefreshToken()\r\n    if (refreshToken) {\r\n      try {\r\n        const refreshResponse = await fetch(`${BASE_URL}/token/refresh/`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ refresh: refreshToken }),\r\n        })\r\n\r\n        if (refreshResponse.ok) {\r\n          const { access } = await refreshResponse.json()\r\n          localStorage.setItem(ACCESS_TOKEN_KEY, access)\r\n          headers.set(\"Authorization\", `Bearer ${access}`)\r\n          response = await fetch(url, { ...options, headers })\r\n        }\r\n      } catch (error) {\r\n        authService.clearTokens()\r\n        window.location.href = \"/login\"\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}))\r\n    throw new Error(error.detail || error.message || `API Error: ${response.status}`)\r\n  }\r\n\r\n  return response.json()\r\n}\r\n\r\nexport const requestsService = {\r\n  // List requests with filters\r\n  async listRequests(params?: ListRequestsParams): Promise<RequestsListResponse> {\r\n    const queryParams = new URLSearchParams()\r\n    if (params?.category) queryParams.append(\"category\", params.category)\r\n    if (params?.status) queryParams.append(\"status\", params.status)\r\n    if (params?.fab_type) queryParams.append(\"fab_type\", params.fab_type)\r\n    if (params?.team_id) queryParams.append(\"team_id\", params.team_id)\r\n    if (params?.search) queryParams.append(\"search\", params.search)\r\n    if (params?.ordering) queryParams.append(\"ordering\", params.ordering)\r\n    if (params?.page) queryParams.append(\"page\", params.page.toString())\r\n\r\n    const endpoint = `/requests/?${queryParams.toString()}`\r\n    return apiCall<RequestsListResponse>(endpoint)\r\n  },\r\n\r\n  // Get queue snapshot\r\n  async getQueueSnapshot(includePositions = true): Promise<RequestsListResponse> {\r\n    const endpoint = `/requests/queue/?include_positions=${includePositions}`\r\n    return apiCall<RequestsListResponse>(endpoint)\r\n  },\r\n\r\n  // Filtered queue snapshot (canonical ordering, optional positions, pagination)\r\n  async getFilteredQueueSnapshot(params: QueueSnapshotParams): Promise<QueueSnapshotResponse> {\r\n    const qp = new URLSearchParams()\r\n    if (params.category) qp.append(\"category\", params.category)\r\n    if (params.status) qp.append(\"status\", params.status)\r\n    if (params.fab_type) qp.append(\"fab_type\", params.fab_type)\r\n    if (params.include_positions !== undefined) qp.append(\"include_positions\", params.include_positions ? \"true\" : \"false\")\r\n    if (params.page) qp.append(\"page\", params.page.toString())\r\n    if (params.page_size) qp.append(\"page_size\", params.page_size.toString())\r\n    const endpoint = `/requests/queue/?${qp.toString()}`\r\n    return apiCall<QueueSnapshotResponse>(endpoint)\r\n  },\r\n\r\n  // Get single request\r\n  async getRequest(id: number): Promise<RequestData> {\r\n    return apiCall<RequestData>(`/requests/${id}/`)\r\n  },\r\n\r\n  // Create BOM request\r\n  async createBOMRequest(teamId: string, notes: string, items: BOMItem[]): Promise<RequestData> {\r\n    return apiCall<RequestData>(\"/requests/\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        team_id: teamId,\r\n        category: \"BOM\",\r\n        notes,\r\n        bom_items: items,\r\n      }),\r\n    })\r\n  },\r\n\r\n  // Create Additional request\r\n  async createAdditionalRequest(teamId: string, notes: string, items: AdditionalItem[]): Promise<RequestData> {\r\n    return apiCall<RequestData>(\"/requests/\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        team_id: teamId,\r\n        category: \"ADDITIONAL\",\r\n        notes,\r\n        additional_items: items,\r\n      }),\r\n    })\r\n  },\r\n\r\n  // Create Fabrication request with file\r\n  async createFabricationRequest(\r\n    teamId: string,\r\n    notes: string,\r\n    fabDetails: FabricationDetails,\r\n    file?: File,\r\n  ): Promise<RequestData> {\r\n    const formData = new FormData()\r\n    formData.append(\"team_id\", teamId)\r\n    formData.append(\"category\", \"FABRICATION\")\r\n    formData.append(\"notes\", notes)\r\n    formData.append(\"fabrication\", JSON.stringify(fabDetails))\r\n    if (file) {\r\n      formData.append(\"file\", file)\r\n    }\r\n\r\n    const accessToken = authService.getAccessToken()\r\n    const headers = new Headers()\r\n    if (accessToken) {\r\n      headers.set(\"Authorization\", `Bearer ${accessToken}`)\r\n    }\r\n\r\n    const response = await fetch(`${BASE_URL}/requests/`, {\r\n      method: \"POST\",\r\n      headers,\r\n      body: formData,\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({}))\r\n      throw new Error(error.detail || error.message || `API Error: ${response.status}`)\r\n    }\r\n\r\n    return response.json()\r\n  },\r\n\r\n  // Change request status\r\n  async changeRequestStatus(id: number, toStatus: string, note?: string, remarks?: string): Promise<RequestData> {\r\n    return apiCall<RequestData>(`/requests/${id}/change_status/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        to_status: toStatus,\r\n        note: note || \"\",\r\n        ...(remarks !== undefined ? { remarks } : {}),\r\n      }),\r\n    })\r\n  },\r\n\r\n  // List all requests for a specific team via dedicated endpoint\r\n  async listTeamRequests(teamId: string, params?: TeamRequestsParams): Promise<RequestsListResponse> {\r\n    const qp = new URLSearchParams()\r\n    if (params?.category) qp.append(\"category\", params.category)\r\n    if (params?.status) qp.append(\"status\", params.status)\r\n    if (params?.fab_type) qp.append(\"fab_type\", params.fab_type)\r\n    if (params?.search) qp.append(\"search\", params.search)\r\n    if (params?.ordering) qp.append(\"ordering\", params.ordering)\r\n    if (params?.page) qp.append(\"page\", params.page.toString())\r\n    if (params?.page_size) qp.append(\"page_size\", params.page_size.toString())\r\n    const endpoint = `/teams/${teamId}/requests/${qp.toString() ? `?${qp.toString()}` : \"\"}`\r\n    return apiCall<RequestsListResponse>(endpoint)\r\n  },\r\n}\r\n","const DEFAULT_REQUESTS_SERVICE_URL = \"http://127.0.0.1:8001\"\r\nconst FALLBACK_REQUESTS_BASE_URL = `${DEFAULT_REQUESTS_SERVICE_URL}/requests/api`\r\n\r\nfunction normalizeRequestsPath(pathname: string): string {\r\n  let normalized = pathname.replace(/\\/+$/, \"\")\r\n  if (!normalized) return \"/requests/api\"\r\n  if (!normalized.startsWith(\"/\")) normalized = `/${normalized}`\r\n  if (normalized.endsWith(\"/requests/api\")) return normalized\r\n  if (normalized.endsWith(\"/requests\")) return `${normalized}/api`\r\n  if (normalized.endsWith(\"/api\")) return normalized.replace(/\\/api$/, \"/requests/api\")\r\n  return `${normalized}/requests/api`\r\n}\r\n\r\nfunction deriveRequestsPrefix(pathname: string): string {\r\n  const fullPath = normalizeRequestsPath(pathname)\r\n  if (fullPath === \"/requests/api\") return \"/requests\"\r\n  return fullPath.replace(/\\/api$/, \"\") || \"/requests\"\r\n}\r\n\r\n/**\r\n * Build the requests service REST base URL, preferring env and falling back to localhost.\r\n */\r\nexport function buildRequestsBaseUrl(): string {\r\n  const envUrl = process.env.NEXT_PUBLIC_REQUESTS_SERVICE_URL\r\n  if (!envUrl) return FALLBACK_REQUESTS_BASE_URL\r\n\r\n  if (envUrl.startsWith(\"/\")) {\r\n    return normalizeRequestsPath(envUrl)\r\n  }\r\n\r\n  try {\r\n    const url = new URL(envUrl)\r\n    url.pathname = normalizeRequestsPath(url.pathname)\r\n    return `${url.origin}${url.pathname}`\r\n  } catch (err) {\r\n    console.warn(\"[ws-url] invalid NEXT_PUBLIC_REQUESTS_SERVICE_URL, using default\", err)\r\n    return FALLBACK_REQUESTS_BASE_URL\r\n  }\r\n}\r\n\r\n/**\r\n * Build WebSocket URL for the requests service, appending JWT token as query param.\r\n */\r\nexport function buildRequestsWsUrl(token: string): string | null {\r\n  const explicitWs = process.env.NEXT_PUBLIC_REQUESTS_WS_URL\r\n  if (explicitWs) {\r\n    try {\r\n      const wsUrl = new URL(explicitWs)\r\n      wsUrl.searchParams.set(\"token\", token)\r\n      return wsUrl.toString()\r\n    } catch (err) {\r\n      console.warn(\"[ws-url] invalid NEXT_PUBLIC_REQUESTS_WS_URL, falling back\", err)\r\n    }\r\n  }\r\n\r\n  const baseRestUrl = process.env.NEXT_PUBLIC_REQUESTS_SERVICE_URL\r\n  let origin = \"\"\r\n  let prefixPath = \"/requests\"\r\n\r\n  if (baseRestUrl) {\r\n    if (baseRestUrl.startsWith(\"http\")) {\r\n      try {\r\n        const url = new URL(baseRestUrl)\r\n        origin = url.origin\r\n        prefixPath = deriveRequestsPrefix(url.pathname)\r\n      } catch (err) {\r\n        console.warn(\"[ws-url] invalid NEXT_PUBLIC_REQUESTS_SERVICE_URL, using defaults\", err)\r\n      }\r\n    } else {\r\n      prefixPath = deriveRequestsPrefix(baseRestUrl)\r\n    }\r\n  }\r\n\r\n  if (!origin) origin = DEFAULT_REQUESTS_SERVICE_URL\r\n\r\n  const secure = origin.startsWith(\"https://\")\r\n  const protocol = secure ? \"wss\" : \"ws\"\r\n  const host = origin.replace(/^https?:\\/\\//, \"\")\r\n  let wsPath = `${prefixPath}/ws/requests/`\r\n  wsPath = wsPath.replace(/\\/+/g, \"/\")\r\n  if (!wsPath.startsWith(\"/\")) wsPath = `/${wsPath}`\r\n\r\n  return `${protocol}://${host}${wsPath}?token=${encodeURIComponent(token)}`\r\n}\r\n","\"use client\"\r\nimport React from \"react\"\r\n\r\ninterface RequestProgressProps {\r\n  status: string\r\n}\r\n\r\nconst steps = [\"Submitted\", \"Processing\", \"Issued\"]\r\n\r\nexport function RequestProgress({ status }: RequestProgressProps) {\r\n  return (\r\n    <div className=\"flex items-center gap-2\" aria-label=\"Request status progress\">\r\n      {steps.map((step, idx) => {\r\n        const currentIndex = steps.indexOf(status)\r\n        const done = currentIndex >= idx\r\n        const active = currentIndex === idx\r\n        return (\r\n          <React.Fragment key={step}>\r\n            <div\r\n              className={`flex flex-col items-center text-[10px] font-medium ${done ? \"text-[#002449]\" : \"text-gray-400\"}`}\r\n            >\r\n              <div\r\n                className={`h-2.5 w-2.5 rounded-full ${done ? (active ? \"bg-[#f75700]\" : \"bg-[#002449]\") : \"bg-gray-300\"}`}\r\n              />\r\n              <span className=\"mt-1 tracking-wide\">{step}</span>\r\n            </div>\r\n            {idx < steps.length - 1 && (\r\n              <div\r\n                className={`h-px w-6 ${currentIndex > idx ? \"bg-[#002449]\" : \"bg-gray-300\"}`}\r\n                aria-hidden=\"true\"\r\n              />\r\n            )}\r\n          </React.Fragment>\r\n        )\r\n      })}\r\n    </div>\r\n  )\r\n}\r\n","\"use client\"\r\n\r\nimport { useMemo, useState, useEffect } from \"react\"\r\n\r\ninterface StatusChangeModalProps {\r\n  open: boolean\r\n  currentStatus: string\r\n  targetStatus: string\r\n  onClose: () => void\r\n  onConfirm: (remarks?: string) => void\r\n  loading?: boolean\r\n}\r\n\r\nconst SHOULD_REQUIRE_REMARKS = (currentStatus: string, targetStatus: string) => {\r\n  if (targetStatus === \"Cannot be Processed\") return true\r\n  return currentStatus === \"Processing\" && targetStatus === \"Issued\"\r\n}\r\n\r\nexport function StatusChangeModal({\r\n  open,\r\n  currentStatus,\r\n  targetStatus,\r\n  onClose,\r\n  onConfirm,\r\n  loading = false,\r\n}: StatusChangeModalProps) {\r\n  const [remarks, setRemarks] = useState(\"\")\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      setRemarks(\"\")\r\n    }\r\n  }, [open, currentStatus, targetStatus])\r\n\r\n  const requiresRemarks = useMemo(\r\n    () => SHOULD_REQUIRE_REMARKS(currentStatus, targetStatus),\r\n    [currentStatus, targetStatus],\r\n  )\r\n\r\n  if (!open) return null\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4\">\r\n      <div className=\"w-full max-w-md rounded-lg bg-white p-6 shadow-xl animate-in fade-in slide-in-from-bottom\">\r\n        <h2 className=\"mb-4 text-lg font-semibold\" style={{ color: \"#002449\" }}>\r\n          Confirm Status Update\r\n        </h2>\r\n\r\n        <div className=\"mb-4 space-y-2 text-sm\">\r\n          <p className=\"text-gray-600\">\r\n            You are changing the request from <span className=\"font-semibold\">{currentStatus}</span> to {\" \"}\r\n            <span className=\"font-semibold\">{targetStatus}</span>.\r\n          </p>\r\n          <p className=\"text-[11px] uppercase tracking-wide text-gray-500\">\r\n            {requiresRemarks ? \"A remark for the team is required before you continue.\" : \"Review the update and confirm when ready.\"}\r\n          </p>\r\n        </div>\r\n\r\n        {requiresRemarks && (\r\n          <div className=\"mb-5 space-y-2\">\r\n            <label className=\"text-xs font-semibold uppercase tracking-wide text-gray-600\">Remarks for Team (required)</label>\r\n            <textarea\r\n              value={remarks}\r\n              onChange={(event) => setRemarks(event.target.value)}\r\n              placeholder=\"Share any guidance or context for the team.\"\r\n              className=\"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#f75700]/40\"\r\n              rows={3}\r\n            />\r\n            <p className=\"text-[11px] text-gray-500\">\r\n              These remarks are visible to the team on their dashboard and request view.\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"flex gap-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            disabled={loading}\r\n            className=\"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => onConfirm(remarks.trim() || undefined)}\r\n            disabled={loading}\r\n            className=\"flex-1 rounded-lg bg-[#f75700] px-4 py-2 text-sm font-semibold text-white transition hover:bg-[#f75700]/90 disabled:cursor-not-allowed disabled:opacity-60\"\r\n          >\r\n            {loading ? \"Updating...\" : \"Confirm\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}