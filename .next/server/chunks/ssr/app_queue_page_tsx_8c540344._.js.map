{"version":3,"sources":["../../../../app/queue/page.tsx","../../../../hooks/use-requests-queue.ts"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useMemo, useCallback } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport { authService } from \"@/lib/auth-service\"\r\nimport { requestsService, type RequestData } from \"@/lib/requests-service\"\r\nimport { formatRequestTitle } from \"@/lib/utils\"\r\nimport { useRequestsQueue } from \"@/hooks/use-requests-queue\"\r\nimport { DashboardShell } from \"@/components/navigation/dashboard-shell\"\r\nimport { RequestProgress } from \"@/components/requests/request-progress\"\r\nimport { cn } from \"@/lib/utils\"\r\nimport { StatusChangeModal } from \"@/components/modals/status-change-modal\"\r\n\r\nexport default function QueuePage() {\r\n  const router = useRouter()\r\n  const [error, setError] = useState(\"\")\r\n  const user = authService.getCurrentUser()\r\n\r\n  // Filters\r\n  const [categoryFilter, setCategoryFilter] = useState<string>(\"\")\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"\")\r\n  const [fabTypeFilter, setFabTypeFilter] = useState<string>(\"\")\r\n  const [searchFilter, setSearchFilter] = useState(\"\")\r\n\r\n  // Check authentication and authorization\r\n  useEffect(() => {\r\n    const token = authService.getAccessToken()\r\n    if (!token) {\r\n      router.push(\"/login\")\r\n      return\r\n    }\r\n\r\n    // Verify user is POC or admin\r\n    const user = authService.getCurrentUser()\r\n    if (!user || (!user.is_poc && !user.is_admin)) {\r\n      router.push(\"/dashboard\")\r\n    }\r\n  }, [router])\r\n\r\n  // Hook: snapshot + websocket live queue\r\n  const token = authService.getAccessToken()\r\n  const { requests, live, loading, error: hookError, refresh, forceReconnect, recentlyChangedIds } = useRequestsQueue({\r\n    token,\r\n    pageSize: 50,\r\n    activeOnly: false,\r\n    resyncIntervalMs: 300000,\r\n  })\r\n\r\n  useEffect(() => {\r\n    if (hookError) setError(hookError)\r\n  }, [hookError])\r\n  const [loadingIds, setLoadingIds] = useState<number[]>([])\r\n  const [pendingStatusChange, setPendingStatusChange] = useState<{\r\n    request: RequestData\r\n    nextStatus: string\r\n  } | null>(null)\r\n\r\n  const shouldCollectRemarks = useCallback((currentStatus: string, nextStatus: string) => {\r\n    if (nextStatus === \"Cannot be Processed\") return true\r\n    return currentStatus === \"Processing\" && nextStatus === \"Issued\"\r\n  }, [])\r\n\r\n  const handleStatusChange = async (\r\n    requestId: number,\r\n    newStatus: string,\r\n    remarks?: string,\r\n  ) => {\r\n    setLoadingIds((ids) => (ids.includes(requestId) ? ids : [...ids, requestId]))\r\n\r\n    const finalNote = `Status changed to ${newStatus}`\r\n\r\n    try {\r\n      await requestsService.changeRequestStatus(requestId, newStatus, finalNote, remarks)\r\n      setError(\"\")\r\n      setPendingStatusChange(null)\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : \"Failed to change status\")\r\n    } finally {\r\n      setLoadingIds((ids) => ids.filter((id) => id !== requestId))\r\n    }\r\n  }\r\n\r\n  const initiateStatusChange = (request: RequestData, newStatus: string) => {\r\n    if (shouldCollectRemarks(request.status, newStatus)) {\r\n      setPendingStatusChange({ request, nextStatus: newStatus })\r\n      return\r\n    }\r\n\r\n    void handleStatusChange(request.id, newStatus)\r\n  }\r\n\r\n  const filteredRequests = useMemo(() => {\r\n    const base = requests.filter(req => {\r\n      if (categoryFilter && req.category !== categoryFilter) return false\r\n      if (statusFilter && req.status !== statusFilter) return false\r\n      if (fabTypeFilter && req.fabrication?.fab_type !== fabTypeFilter) return false\r\n      if (searchFilter) {\r\n        const haystack = (req.notes || '') + ' ' + req.bom_items.map(i => i.item_name).join(' ') + ' ' + req.additional_items.map(i => i.item_name).join(' ')\r\n        if (!haystack.toLowerCase().includes(searchFilter.toLowerCase())) return false\r\n      }\r\n      return true\r\n    })\r\n    if (!statusFilter) {\r\n      return base.filter(r => r.status !== 'Issued' && r.status !== 'Cannot be Processed')\r\n    }\r\n    return base\r\n  }, [requests, categoryFilter, statusFilter, fabTypeFilter, searchFilter])\r\n\r\n  const metrics = useMemo(() => ({\r\n    total: filteredRequests.length,\r\n    submitted: filteredRequests.filter(r => r.status === 'Submitted').length,\r\n    processing: filteredRequests.filter(r => r.status === 'Processing').length,\r\n    issued: filteredRequests.filter(r => r.status === 'Issued').length,\r\n    rejected: filteredRequests.filter(r => r.status === 'Cannot be Processed').length,\r\n  }), [filteredRequests])\r\n\r\n  return (\r\n    <DashboardShell>\r\n      <div className=\"space-y-8\">\r\n        {/* Metrics Strip */}\r\n        <div className=\"w-full bg-white border border-gray-200 rounded-lg overflow-hidden\">\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5\">\r\n            <MetricStripItem label=\"Total\" value={metrics.total} color=\"#002449\" />\r\n            <MetricStripItem label=\"Submitted\" value={metrics.submitted} color=\"#f75700\" />\r\n            <MetricStripItem label=\"Processing\" value={metrics.processing} color=\"#007367\" />\r\n            <MetricStripItem label=\"Issued\" value={metrics.issued} color=\"#078e31\" />\r\n            <MetricStripItem label=\"Rejected\" value={metrics.rejected} color=\"#6b7280\" />\r\n          </div>\r\n        </div>\r\n        <ConnectionStatus\r\n          live={live}\r\n          onRefresh={refresh}\r\n          onReconnect={forceReconnect}\r\n          ordering=\"FCFS\"\r\n        />\r\n        {/* Filters Toolbar */}\r\n        <div className=\"bg-white border border-gray-200 rounded-lg p-3 flex flex-col gap-3\">\r\n          <div className=\"flex flex-wrap gap-3 items-center\">\r\n            <FilterSegment\r\n              label=\"Category\"\r\n              value={categoryFilter}\r\n              onChange={setCategoryFilter}\r\n              options={['', 'BOM', 'ADDITIONAL', 'FABRICATION']}\r\n            />\r\n            <FilterSegment\r\n              label=\"Status\"\r\n              value={statusFilter}\r\n              onChange={setStatusFilter}\r\n              options={['', 'Submitted', 'Processing', 'Issued', 'Cannot be Processed']}\r\n            />\r\n            <FilterSegment\r\n              label=\"Fab\"\r\n              value={fabTypeFilter}\r\n              onChange={setFabTypeFilter}\r\n              options={['', '3D', 'LASER', 'OTHER']}\r\n            />\r\n            <div className=\"flex items-center gap-2 ml-auto w-full sm:w-auto\">\r\n              <input\r\n                type=\"text\"\r\n                placeholder=\"Search\"\r\n                value={searchFilter}\r\n                onChange={(e) => setSearchFilter(e.target.value)}\r\n                className=\"px-3 py-2 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent w-full sm:w-56\"\r\n              />\r\n              <button\r\n                onClick={() => { setCategoryFilter(''); setStatusFilter(''); setFabTypeFilter(''); setSearchFilter('') }}\r\n                className=\"px-3 py-2 text-sm rounded-md border border-gray-300 hover:bg-gray-50\"\r\n              >Clear</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Error Message */}\r\n        {error && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n        )}\r\n\r\n        {/* Queue FCFS Cards */}\r\n        <div className=\"space-y-3\">\r\n          {loading ? (\r\n            <div className=\"py-12 text-center text-sm text-gray-600 bg-white border border-gray-200 rounded-lg\">Loading queue...</div>\r\n          ) : filteredRequests.length === 0 ? (\r\n            <div className=\"py-12 text-center text-sm text-gray-600 bg-white border border-gray-200 rounded-lg\">No requests match filters.</div>\r\n          ) : (\r\n            <ul className=\"space-y-3\">\r\n              {filteredRequests.map((r, idx) => (\r\n                <li key={r.id}>\r\n                    <QueueRow\r\n                      request={r}\r\n                      position={idx + 1}\r\n                      onAdvance={initiateStatusChange}\r\n                      canAdvance={!!user && (user.is_poc || user.is_admin)}\r\n                      highlight={recentlyChangedIds.includes(r.id)}\r\n                      loading={loadingIds.includes(r.id)}\r\n                    />\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {pendingStatusChange && (\r\n        <StatusChangeModal\r\n          open={!!pendingStatusChange}\r\n          currentStatus={pendingStatusChange.request.status}\r\n          targetStatus={pendingStatusChange.nextStatus}\r\n          loading={loadingIds.includes(pendingStatusChange.request.id)}\r\n          onClose={() => setPendingStatusChange(null)}\r\n          onConfirm={async (remarks) => {\r\n            if (!pendingStatusChange) return\r\n            await handleStatusChange(\r\n              pendingStatusChange.request.id,\r\n              pendingStatusChange.nextStatus,\r\n              remarks,\r\n            )\r\n          }}\r\n        />\r\n      )}\r\n    </DashboardShell>\r\n  )\r\n}\r\n\r\nfunction categoryBadgeColor(category: string) {\r\n  if (category === 'BOM') return '#002449'\r\n  if (category === 'ADDITIONAL') return '#007367'\r\n  if (category === 'FABRICATION') return '#f75700'\r\n  return '#6b7280'\r\n}\r\nfunction statusAccent(status: string) {\r\n  if (status === 'Submitted') return '#f75700'\r\n  if (status === 'Processing') return '#007367'\r\n  if (status === 'Issued') return '#078e31'\r\n  if (status === 'Cannot be Processed') return '#6b7280'\r\n  return '#002449'\r\n}\r\n\r\ninterface QueueRowProps {\r\n  request: RequestData\r\n  position: number\r\n  onAdvance: (request: RequestData, next: string) => void\r\n  canAdvance: boolean\r\n  highlight?: boolean\r\n  loading?: boolean\r\n}\r\n\r\nfunction QueueRow({ request, position, onAdvance, canAdvance, highlight = false, loading = false }: QueueRowProps) {\r\n  const nextStatus = request.status === 'Submitted'\r\n    ? 'Processing'\r\n    : request.status === 'Processing'\r\n      ? 'Issued'\r\n      : ''\r\n\r\n  return (\r\n    <div className={`relative bg-white border border-gray-200 rounded-lg p-4 flex flex-col gap-3 shadow-sm hover:shadow-md transition ${highlight ? 'flash-update' : ''} ${loading ? 'opacity-60 pointer-events-none' : ''}`}>\r\n      <div className=\"flex flex-wrap items-center gap-2\">\r\n        <span className=\"inline-flex items-center justify-center w-6 h-6 text-[11px] font-semibold rounded-full bg-gray-100 border border-gray-200 text-gray-600\">{position}</span>\r\n        <span className=\"px-2 py-1 text-[11px] font-semibold text-white rounded-md\" style={{ backgroundColor: categoryBadgeColor(request.category) }}>{request.category}</span>\r\n        <RequestProgress status={request.status} />\r\n        <span className=\"px-2 py-1 text-[11px] font-semibold rounded-md\" style={{ backgroundColor: statusAccent(request.status), color: '#fff' }}>{request.status}</span>\r\n        {request.team_name && (\r\n          <span className=\"ml-auto inline-flex items-center gap-1 px-3 py-1 text-[11px] font-semibold rounded-full bg-[#002449] text-white\">\r\n            {request.team_name}\r\n          </span>\r\n        )}\r\n      </div>\r\n      <h3 className=\"text-sm font-semibold text-gray-900 line-clamp-2\">{formatRequestTitle(request)}</h3>\r\n      <div className=\"flex flex-wrap gap-4 text-[11px] text-gray-600\">\r\n        {(request.bom_items?.length || 0) > 0 && <span>BOM: {request.bom_items.length}</span>}\r\n        {(request.additional_items?.length || 0) > 0 && <span>Additional: {request.additional_items.length}</span>}\r\n        {request.fabrication && <span>Fab: {request.fabrication.fab_type} â€¢ {request.fabrication.name}</span>}\r\n        <span>Created: {new Date(request.created_at).toLocaleTimeString()}</span>\r\n        <span>Updated: {new Date(request.updated_at).toLocaleTimeString()}</span>\r\n      </div>\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        <a\r\n          href={`/requests/${request.id}`}\r\n          className=\"px-3 py-1.5 text-[11px] font-medium rounded-md border border-gray-300 hover:bg-gray-50\"\r\n        >View</a>\r\n        {canAdvance && nextStatus && (\r\n          <button\r\n            onClick={() => onAdvance(request, nextStatus)}\r\n            disabled={loading}\r\n            className=\"px-3 py-1.5 text-[11px] font-medium rounded-md text-white\"\r\n            style={{ backgroundColor: nextStatus === 'Processing' ? '#007367' : '#078e31' }}\r\n          >{nextStatus === 'Processing' ? 'Accept' : 'Issue'}</button>\r\n        )}\r\n        {canAdvance && request.status !== 'Issued' && request.status !== 'Cannot be Processed' && (\r\n          <button\r\n            onClick={() => onAdvance(request, 'Cannot be Processed')}\r\n            disabled={loading}\r\n            className=\"px-3 py-1.5 text-[11px] font-medium rounded-md text-white bg-[#f75700]\"\r\n          >Reject</button>\r\n        )}\r\n        {loading && (\r\n          <span className=\"inline-flex items-center gap-1 px-2 py-1 text-[10px] font-medium rounded bg-gray-800 text-white\">Updating...</span>\r\n        )}\r\n      </div>\r\n      {request.remarks && (\r\n        <div className=\"rounded-md border border-dashed border-gray-200 bg-gray-50 px-3 py-2 text-[11px] text-gray-600\">\r\n          <p className=\"mb-1 text-[10px] font-semibold uppercase tracking-wide text-[#002449]\">Remarks</p>\r\n          <p className=\"whitespace-pre-line text-xs text-gray-700\">{request.remarks}</p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction MetricCard({ label, value, color }: { label: string; value: number; color: string }) {\r\n  return (\r\n    <div className=\"rounded-lg border border-gray-200 bg-white p-3 flex flex-col\">\r\n      <span className=\"text-[10px] uppercase tracking-wide font-medium text-gray-500\">{label}</span>\r\n      <span className=\"text-xl font-bold\" style={{ color }}>{value}</span>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction MetricPill() { return null }\r\nfunction MetricStripItem({ label, value, color }: { label: string; value: number; color: string }) {\r\n  return (\r\n    <div className=\"flex items-center justify-between gap-2 px-4 py-2 text-sm border-r last:border-r-0 border-gray-200\">\r\n      <span className=\"text-[11px] font-medium text-gray-500 uppercase tracking-wide\">{label}</span>\r\n      <span className=\"text-base font-semibold\" style={{ color }}>{value}</span>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction FilterSegment({ label, options, value, onChange }: { label: string; options: string[]; value: string; onChange: (v: string) => void }) {\r\n  return (\r\n    <div className=\"flex flex-col gap-1\">\r\n      <span className=\"text-[10px] uppercase tracking-wide font-semibold text-gray-500\">{label}</span>\r\n      <div className=\"flex flex-wrap gap-1\">\r\n        {options.map(opt => (\r\n          <button\r\n            key={opt || 'all'}\r\n            onClick={() => onChange(opt)}\r\n            className={cn(\r\n              \"px-2 py-1 text-[11px] rounded-md border transition-colors\",\r\n              value === opt\r\n                ? \"bg-accent text-white border-accent\"\r\n                : \"bg-white hover:bg-gray-50 text-gray-600 border-gray-300\"\r\n            )}\r\n            type=\"button\"\r\n          >{opt === '' ? 'All' : opt}</button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nfunction ConnectionStatus({ live, ordering, onRefresh, onReconnect }: { live: boolean; ordering: string; onRefresh: () => void; onReconnect: () => void }) {\r\n  return (\r\n    <div className=\"flex flex-wrap gap-3 items-center bg-white border border-gray-200 rounded-lg p-3\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <span className={`inline-flex items-center gap-1 px-2 py-1 rounded-md text-[11px] font-medium ${live ? 'bg-green-50 text-green-700 border border-green-200' : 'bg-red-50 text-red-700 border border-red-200'}`}>\r\n          <span className={`inline-block w-2 h-2 rounded-full ${live ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`}></span>\r\n          {live ? 'Live' : 'Disconnected'}\r\n        </span>\r\n        <span className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md text-[11px] font-medium bg-gray-50 border border-gray-200\">Ordering: {ordering}</span>\r\n      </div>\r\n      <div className=\"flex items-center gap-2 ml-auto\">\r\n        <button\r\n          onClick={onRefresh}\r\n          className=\"px-3 py-1.5 text-[11px] font-medium rounded-md border border-gray-300 hover:bg-gray-50\"\r\n        >Refresh</button>\r\n        <button\r\n          onClick={onReconnect}\r\n          className=\"px-3 py-1.5 text-[11px] font-medium rounded-md border border-gray-300 hover:bg-gray-50\"\r\n        >Reconnect</button>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n","\"use client\"\r\n\r\n// Comprehensive Requests Queue hook implementing:\r\n// 1. Initial canonical snapshot fetch (REST) with optional positions\r\n// 2. WebSocket subscription with resilient exponential backoff\r\n// 3. Upsert + ordering (FCFS oldest-first) using Map for O(1) access\r\n// 4. State transition handling (remove if filtered out)\r\n// 5. Re-sync on reconnect & periodic interval\r\n// 6. Placeholder comments for future optimistic create support\r\n\r\nimport { useCallback, useEffect, useRef, useState } from 'react'\r\nimport { requestsService, type RequestData, type QueueSnapshotParams } from '@/lib/requests-service'\r\nimport { authService } from '@/lib/auth-service'\r\nimport { buildRequestsWsUrl } from '@/lib/ws-url'\r\n\r\nexport interface QueueEventMessage {\r\n  event: 'request_created' | 'request_updated' | 'state_transition'\r\n  request?: RequestData\r\n  request_id?: number\r\n  from?: string\r\n  to?: string\r\n  changed_by?: string\r\n  timestamp?: string\r\n  note?: string\r\n}\r\n\r\ninterface UseRequestsQueueOptions extends Omit<QueueSnapshotParams, 'include_positions' | 'page' | 'page_size'> {\r\n  pageSize?: number\r\n  activeOnly?: boolean // If true, hide Issued / Cannot be Processed\r\n  resyncIntervalMs?: number\r\n  token?: string // optional explicit JWT override\r\n  dropUnfilteredEvents?: boolean // if true, ignore events not matching current filters instead of upserting then filtering\r\n}\r\n\r\ninterface RequestsQueueState {\r\n  requests: RequestData[]\r\n  live: boolean\r\n  loading: boolean\r\n  error: string\r\n  refresh: () => Promise<void>\r\n  upsertById: (req: RequestData) => void\r\n  forceReconnect: () => void\r\n  recentlyChangedIds: number[]\r\n}\r\n\r\nexport function useRequestsQueue(options: UseRequestsQueueOptions = {}): RequestsQueueState {\r\n  const { category, status, fab_type, pageSize = 50, activeOnly = false, resyncIntervalMs = 300000, token, dropUnfilteredEvents = true } = options\r\n  const [requests, setRequests] = useState<RequestData[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState('')\r\n  const [live, setLive] = useState(false)\r\n  const [recentlyChangedIds, setRecentlyChangedIds] = useState<number[]>([])\r\n  const highlightTimeoutsRef = useRef<Map<number, NodeJS.Timeout>>(new Map())\r\n\r\n  // Internal store (Map) for O(1) upsert\r\n  const storeRef = useRef<{ byId: Map<number, RequestData>; list: RequestData[] }>({ byId: new Map(), list: [] })\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  const backoffRef = useRef(1000)\r\n  const reconnectingRef = useRef(false)\r\n  const intervalRef = useRef<NodeJS.Timeout | null>(null)\r\n  const closedRef = useRef(false)\r\n\r\n  const applyList = useCallback((list: RequestData[]) => {\r\n    storeRef.current.byId.clear()\r\n    list.forEach(r => storeRef.current.byId.set(r.id, r))\r\n    storeRef.current.list = list\r\n    setRequests(list)\r\n  }, [])\r\n\r\n  const computeOrdered = useCallback((arr: RequestData[]) => {\r\n    const ordered = [...arr].sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime())\r\n    return ordered.map((r, idx) => ({ ...r, position: r.position ?? (idx + 1) }))\r\n  }, [])\r\n\r\n  const snapshotFetch = useCallback(async () => {\r\n    try {\r\n      setLoading(true)\r\n      setError('')\r\n      const params: QueueSnapshotParams = {\r\n        include_positions: true,\r\n        page: 1,\r\n        page_size: pageSize,\r\n        category,\r\n        status,\r\n        fab_type,\r\n      }\r\n      const snap = await requestsService.getFilteredQueueSnapshot(params)\r\n      // Filter active-only if enabled\r\n      const filtered = activeOnly ? snap.results.filter(r => !['Issued', 'Cannot be Processed'].includes(r.status)) : snap.results\r\n      applyList(computeOrdered(filtered))\r\n    } catch (err) {\r\n      console.error('[queue-hook] snapshot error', err)\r\n      setError(err instanceof Error ? err.message : 'Snapshot fetch failed')\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [applyList, computeOrdered, category, status, fab_type, pageSize, activeOnly])\r\n\r\n  const upsert = useCallback((req: RequestData) => {\r\n    const store = storeRef.current\r\n    store.byId.set(req.id, req)\r\n    const idx = store.list.findIndex(r => r.id === req.id)\r\n    if (idx >= 0) {\r\n      store.list[idx] = req\r\n    } else {\r\n      // Insert preserving created_at ascending\r\n      const pos = store.list.findIndex(r => new Date(r.created_at) > new Date(req.created_at))\r\n      if (pos === -1) store.list.push(req)\r\n      else store.list.splice(pos, 0, req)\r\n    }\r\n    // Active-only filtering\r\n    let list = store.list\r\n    if (activeOnly) list = list.filter(r => !['Issued', 'Cannot be Processed'].includes(r.status))\r\n    const ordered = computeOrdered(list)\r\n    setRequests(ordered)\r\n  }, [activeOnly, computeOrdered])\r\n\r\n  const applyTransition = useCallback((id: number, to: string) => {\r\n    const store = storeRef.current\r\n    const existing = store.byId.get(id)\r\n    if (!existing) return\r\n    const updated = { ...existing, status: to as any }\r\n    store.byId.set(id, updated)\r\n    const idx = store.list.findIndex(r => r.id === id)\r\n    if (idx >= 0) store.list[idx] = updated\r\n    // Remove if activeOnly and becomes terminal\r\n    let list = store.list\r\n    if (activeOnly && ['Issued', 'Cannot be Processed'].includes(updated.status)) {\r\n      list = list.filter(r => r.id !== id)\r\n      store.list = list\r\n    }\r\n    const ordered = computeOrdered(list)\r\n    setRequests(ordered)\r\n  }, [activeOnly, computeOrdered])\r\n\r\n  const registerHighlight = useCallback((id: number) => {\r\n    setRecentlyChangedIds(prev => prev.includes(id) ? prev : [...prev, id])\r\n    // Clear existing timeout if re-triggered\r\n    const existing = highlightTimeoutsRef.current.get(id)\r\n    if (existing) clearTimeout(existing)\r\n    const to = setTimeout(() => {\r\n      setRecentlyChangedIds(prev => prev.filter(x => x !== id))\r\n      highlightTimeoutsRef.current.delete(id)\r\n    }, 2000)\r\n    highlightTimeoutsRef.current.set(id, to)\r\n  }, [])\r\n\r\n  const handleMessage = useCallback((msg: QueueEventMessage) => {\r\n    if (msg.event === 'request_created' || msg.event === 'request_updated') {\r\n      if (msg.request) {\r\n        // Optionally drop events that do not match active filters\r\n        if (dropUnfilteredEvents) {\r\n          if (category && msg.request.category !== category) return\r\n          if (status && msg.request.status !== status) return\r\n          if (fab_type && msg.request.fabrication?.fab_type !== fab_type) return\r\n        }\r\n        upsert(msg.request)\r\n        registerHighlight(msg.request.id)\r\n      }\r\n    } else if (msg.event === 'state_transition' && msg.request_id) {\r\n      applyTransition(msg.request_id, msg.to || '')\r\n      registerHighlight(msg.request_id)\r\n    }\r\n  }, [upsert, applyTransition, category, status, fab_type, dropUnfilteredEvents, registerHighlight])\r\n\r\n  const connectWs = useCallback(() => {\r\n    const jwt = token || authService.getAccessToken()\r\n    if (!jwt) return\r\n    const url = buildRequestsWsUrl(jwt)\r\n    if (!url) return\r\n    try {\r\n      wsRef.current = new WebSocket(url)\r\n      wsRef.current.onopen = () => {\r\n        setLive(true)\r\n        backoffRef.current = 1000\r\n        if (reconnectingRef.current) {\r\n          snapshotFetch() // resync after reconnect\r\n          reconnectingRef.current = false\r\n        }\r\n      }\r\n      wsRef.current.onmessage = ev => {\r\n        try {\r\n          const data = JSON.parse(ev.data)\r\n          handleMessage(data)\r\n        } catch (e) {\r\n          console.error('[queue-hook] parse error', e)\r\n        }\r\n      }\r\n      wsRef.current.onclose = () => {\r\n        setLive(false)\r\n        if (closedRef.current) return\r\n        reconnectingRef.current = true\r\n        const delay = backoffRef.current\r\n        setTimeout(() => {\r\n          backoffRef.current = Math.min(backoffRef.current * 1.5, 30000)\r\n          connectWs()\r\n        }, delay)\r\n      }\r\n      wsRef.current.onerror = err => {\r\n        console.error('[queue-hook] ws error', err)\r\n      }\r\n    } catch (err) {\r\n      console.error('[queue-hook] ws connect error', err)\r\n    }\r\n  }, [handleMessage, snapshotFetch])\r\n\r\n  const refresh = useCallback(async () => {\r\n    await snapshotFetch()\r\n  }, [snapshotFetch])\r\n\r\n  const forceReconnect = useCallback(() => {\r\n    if (wsRef.current) {\r\n      wsRef.current.close()\r\n    } else {\r\n      connectWs()\r\n    }\r\n  }, [connectWs])\r\n\r\n  // Init\r\n  useEffect(() => {\r\n    closedRef.current = false\r\n    snapshotFetch().then(() => connectWs())\r\n    // periodic resync\r\n    intervalRef.current = setInterval(() => {\r\n      if (!closedRef.current) snapshotFetch()\r\n    }, resyncIntervalMs)\r\n    return () => {\r\n      closedRef.current = true\r\n      if (intervalRef.current) clearInterval(intervalRef.current)\r\n      wsRef.current?.close()\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [category, status, fab_type, pageSize, activeOnly])\r\n\r\n  // NOTE: For future optimistic create support:\r\n  // Provide a function optimisticCreate(payload) that inserts temp entry with id `temp-<ts>`\r\n  // then replaces or removes based on POST result.\r\n\r\n  return { requests, live, loading, error, refresh, upsertById: upsert, forceReconnect, recentlyChangedIds }\r\n}\r\n"],"names":[],"mappings":"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"}