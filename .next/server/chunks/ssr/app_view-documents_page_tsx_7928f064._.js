module.exports=[79103,a=>{"use strict";var b=a.i(46447),c=a.i(30564),d=a.i(90599),e=a.i(3130),f=a.i(40695),g=a.i(54161),h=a.i(87682),i=a.i(70246),j=a.i(11634),k=a.i(52221),l=a.i(16919),m=a.i(10268),n=a.i(84435),o=a.i(40076),p=a.i(6665),q=a.i(61237);let r=(0,q.default)("FileDown",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),s=(0,q.default)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]]);var t=a.i(49168);function u(){let{toast:q}=(0,i.useToast)(),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)({}),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),Q=(0,c.useMemo)(()=>new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}),[]);(0,c.useEffect)(()=>{let a=j.authService.getCurrentUser(),b=a?.is_admin?"admin":a?.is_poc?"poc":a?"leader":null;v(b),(async()=>{x(!0),D(null);try{if("admin"===b){let a=await j.authService.getAdminTeams(),b=a.map(a=>({id:a.id,label:a.name,subtitle:a.institution,code:a.team_id}));z(b),B(a.reduce((a,b)=>(a[b.id]=b,a),{}));let c=!1;F(a=>a&&b.some(b=>b.id===a)?a:(c=!!a,"")),c&&H([])}else if("poc"===b){let a=(await (0,k.getCachedPOCTeams)()).map(a=>({id:String(a.id),label:a.name,subtitle:a.institution,code:a.team_id}));z(a);let b=!1;F(c=>c&&a.some(a=>a.id===c)?c:(b=!!c,"")),b&&H([])}else if("leader"===b){let a=await j.authService.getTeamDetails();z([{id:a.id,label:a.name,subtitle:a.institution,code:a.team_id}]),B({[a.id]:a});let b=!1;F(c=>c&&c===a.id?c:(b=!!c,"")),b&&H([])}else{z([]);let a=!1;F(b=>b?(a=!0,""):b),a&&H([])}}catch(b){let a=b instanceof Error?b.message:"Unable to load teams.";D(a),q({variant:"destructive",title:"Failed to load teams",description:a})}finally{x(!1)}})()},[q]);let R=!!E&&!!A[E];(0,c.useEffect)(()=>{if(!E)return;let a=!1;return(async()=>{J(!0),L(null);try{if(!R){if("poc"===u){let b=await j.authService.getPOCTeamDetail(E);a||B(a=>({...a,[E]:b}))}else if("leader"===u){let b=await j.authService.getTeamDetails();a||B(a=>({...a,[b.id]:b}))}}let b=await (0,m.getTeamDocumentHistory)(E);if(a)return;H(b)}catch(b){if(a)return;L(b instanceof Error?b.message:"Unable to load documents.")}finally{a||J(!1)}})(),()=>{a=!0}},[R,u,E]);let S=E?A[E]:void 0,T=(0,c.useMemo)(()=>G.length?G.map(a=>{let b=[...a.versions??[]];a.latest_version&&!b.find(b=>b.id===a.latest_version?.id)&&b.unshift(a.latest_version),b.sort((a,b)=>{let c=a.uploaded_at?new Date(a.uploaded_at).getTime():0,d=b.uploaded_at?new Date(b.uploaded_at).getTime():0;return d!==c?d-c:(b.version??0)-(a.version??0)});let c=b.find(a=>(0,l.isApprovedStatus)(a.status));return c?{documentType:a.document_type,version:c,latestStatus:c.status}:null}).filter(a=>null!==a):[],[G]),U=(0,c.useCallback)(a=>{let b=!1;F(c=>c===a?c:(b=!0,a)),b&&H([])},[]),V=(0,c.useCallback)(async a=>{if(a){N(a);try{let{download_url:b}=await (0,m.getDownloadURL)(a)}catch(a){q({variant:"destructive",title:"Download failed",description:a instanceof Error?a.message:"Unable to fetch download link."})}finally{N(null)}}},[q]),W=(0,c.useCallback)(async()=>{if(S&&T.length){P(!0);try{let{default:b}=await a.A(90447),c=new b,d=new Map;for(let a of T){let{download_url:b}=await (0,m.getDownloadURL)(a.version.id),e=await fetch(b);if(!e.ok)throw Error(`Failed to download ${a.version.original_filename??a.documentType}`);let f=await e.arrayBuffer(),g=l.DOCUMENT_SECTIONS_BY_TYPE[a.documentType]?.title??a.documentType,h=`${g}`,i=(a.version.original_filename?.trim()||h).replace(/[^a-zA-Z0-9._-]+/g,"_").replace(/^_+|_+$/g,"").replace(/_{2,}/g,"_").slice(0,120)||"document",j=d.get(i)??0,k=i.lastIndexOf("."),n=k>0?i.slice(0,k):i,o=k>0?i.slice(k):"",p=0===j?i:`${n}_${j}${o}`;d.set(i,j+1),c.file(p,f)}let e=await c.generateAsync({type:"blob"}),f=(S.name?.trim()||"team").replace(/[^a-zA-Z0-9]+/g,"_").replace(/^_+|_+$/g,"").replace(/_{2,}/g,"_").slice(0,80)||"team",g=URL.createObjectURL(e),h=document.createElement("a");h.href=g,h.download=`${f}_docs.zip`,document.body.appendChild(h),h.click(),document.body.removeChild(h),setTimeout(()=>URL.revokeObjectURL(g),4e3),q({title:"Download ready",description:`Downloaded ${T.length} approved documents.`})}catch(a){q({variant:"destructive",title:"ZIP download failed",description:a instanceof Error?a.message:"Unable to download approved documents."})}finally{P(!1)}}},[T,S,q]);return(0,b.jsx)(d.DashboardShell,{children:(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("header",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold tracking-tight",style:{color:"#002449"},children:"Approved Documents"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Review the latest approved uploads for a selected team in one place."})]}),(0,b.jsx)("div",{className:"flex flex-col gap-2 md:items-end",children:(0,b.jsxs)(h.Select,{value:E||void 0,onValueChange:U,disabled:w||0===y.length,children:[(0,b.jsx)(h.SelectTrigger,{className:"w-full min-w-[240px] border border-[#002449]/40 focus:border-[#002449] focus:ring-[#002449]/20",children:(0,b.jsx)(h.SelectValue,{placeholder:w?"Loading teams...":"Select a team"})}),(0,b.jsx)(h.SelectContent,{children:y.map(a=>(0,b.jsx)(h.SelectItem,{value:a.id,children:(0,b.jsx)("span",{className:"flex flex-col text-left",children:(0,b.jsx)("span",{className:"font-medium",children:a.label})})},a.id))})]})})]}),C&&(0,b.jsx)(e.Card,{className:"border border-destructive/20 bg-destructive/5 p-4",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:C})}),!w&&0===y.length&&!C&&(0,b.jsx)(e.Card,{className:"border border-dashed border-gray-200 bg-muted/10 p-6 text-sm text-muted-foreground",children:(0,b.jsx)("p",{children:"admin"===u?"No teams are available yet. Once teams are onboarded, their approved documents will appear here.":"poc"===u?"You do not have any assigned teams yet. Approved documents will appear once teams are mapped to you.":"No team context detected for this account."})}),S&&(0,b.jsx)(e.Card,{className:"border border-gray-200 p-6 shadow-sm",children:(0,b.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:justify-between",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-[#002449]",children:[(0,b.jsx)(p.Users,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"text-sm font-semibold uppercase tracking-wide",children:"Team"})]}),(0,b.jsx)("h2",{className:"text-xl font-semibold",style:{color:"#002449"},children:S.name}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,b.jsx)(o.Building2,{className:"h-3.5 w-3.5"}),S.institution]}),S.team_id&&(0,b.jsxs)(g.Badge,{variant:"outline",className:"text-[11px] font-semibold text-[#f75700]",children:["Team ID • ",S.team_id]}),S.problem_statement?.id&&(0,b.jsxs)(g.Badge,{variant:"secondary",className:"text-[11px] font-semibold",children:["Problem Statement • ",S.problem_statement.id]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Sections"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:l.DOCUMENT_SECTIONS.map(a=>(0,b.jsx)(g.Badge,{variant:"outline",className:"text-[11px]",children:a.title},a.id))})]})]})}),E?(0,b.jsxs)(b.Fragment,{children:[K&&(0,b.jsx)(e.Card,{className:"border border-destructive/20 bg-destructive/5 p-4",children:(0,b.jsx)("p",{className:"text-sm text-destructive",children:K})}),I?(0,b.jsxs)(e.Card,{className:"flex items-center justify-center gap-3 border border-gray-200 p-10 text-sm text-muted-foreground",children:[(0,b.jsx)(n.Loader2,{className:"h-4 w-4 animate-spin text-[#f75700]"}),"Fetching approved documents…"]}):0===T.length?(0,b.jsxs)(e.Card,{className:"border border-dashed border-gray-200 bg-muted/10 p-10 text-center text-sm text-muted-foreground",children:[(0,b.jsx)("div",{className:"mx-auto mb-3 flex h-10 w-10 items-center justify-center rounded-full bg-white text-[#002449] shadow",children:(0,b.jsx)(s,{className:"h-5 w-5"})}),(0,b.jsx)("p",{children:"No approved documents found for the selected team."})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 rounded-md border border-gray-200 bg-white p-4 shadow-sm md:flex-row md:items-center md:justify-between",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[T.length," approved document",1===T.length?"":"s"," ready for download."]}),(0,b.jsxs)(f.Button,{variant:"default",onClick:()=>void W(),disabled:O,"aria-disabled":O,className:"w-full md:w-auto",children:[O?(0,b.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),O?"Preparing ZIP…":"Download all as ZIP"]})]}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:T.map(a=>{var c;let d=l.DOCUMENT_SECTIONS_BY_TYPE[a.documentType]??{title:a.documentType,icon:t.ShieldCheck},h=d.icon,i=a.version.uploaded_at?Q.format(new Date(a.version.uploaded_at)):"—",j=(c=a.version.status)?c.replace(/_/g," ").split(" ").map(a=>a?a[0].toUpperCase()+a.slice(1):a).join(" "):"Unknown",k=function(a){if(!a)return"outline";let b=a.toLowerCase();return["approved","verified","accepted"].includes(b)?"default":["rejected","declined","invalid"].includes(b)?"destructive":["pending","submitted","in_review","processing","awaiting_review"].includes(b)?"secondary":"outline"}(a.version.status);return(0,b.jsxs)(e.Card,{className:"flex h-full flex-col justify-between border border-gray-200 p-5 shadow-sm",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"rounded-lg bg-[#002449]/10 p-2 text-[#002449]",children:(0,b.jsx)(h,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:d.title}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Latest approved upload available for download."})]})]}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-muted-foreground",children:[a.version.original_filename&&(0,b.jsx)("p",{className:"font-medium text-[#002449]",children:a.version.original_filename}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(g.Badge,{variant:k,children:j}),(0,b.jsxs)(g.Badge,{variant:"outline",children:["Version ",a.version.version??"—"]}),i&&(0,b.jsxs)("span",{children:["Uploaded ",i]})]})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex items-center justify-between border-t border-gray-100 pt-4",children:[(0,b.jsxs)("span",{className:"text-[11px] text-muted-foreground",children:["Version ID: ",a.version.id]}),(0,b.jsxs)(f.Button,{size:"sm",variant:"outline",onClick:()=>void V(a.version.id),disabled:M===a.version.id,"aria-disabled":M===a.version.id,children:[M===a.version.id?(0,b.jsx)(n.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(r,{className:"mr-2 h-4 w-4"}),M===a.version.id?"Preparing…":"Download"]})]})]},a.version.id)})})]})]}):!w&&y.length>0&&!C&&(0,b.jsx)(e.Card,{className:"border border-dashed border-[#002449]/30 bg-[#002449]/5 p-8 text-sm text-[#002449]",children:(0,b.jsx)("p",{children:"Select a team from the dropdown to view its approved documents."})})]})})}a.s(["default",()=>u],79103)}];

//# sourceMappingURL=app_view-documents_page_tsx_7928f064._.js.map