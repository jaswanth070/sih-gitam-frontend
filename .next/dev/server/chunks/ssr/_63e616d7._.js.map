{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Jaswanth/Downloads/smart-india-hackathon-app/lib/auth-service.ts"],"sourcesContent":["/**\n * Auth Service API Client\n * Handles all authentication-related API calls with secure token management\n */\n\nconst ACCESS_TOKEN_KEY = \"sih_access_token\"\nconst REFRESH_TOKEN_KEY = \"sih_refresh_token\"\nconst BASE_URL = process.env.NEXT_PUBLIC_AUTH_SERVICE_URL || \"http://127.0.0.1:8000/api\"\n\nexport interface LoginRequest {\n  email: string\n  password: string\n}\n\nexport interface LoginResponse {\n  access: string\n  refresh: string\n}\n\nexport interface OTPRequest {\n  email: string\n  purpose: string\n}\n\nexport interface OTPVerifyRequest {\n  email: string\n  otp: string\n  new_password: string\n}\n\nexport interface RefreshTokenRequest {\n  refresh: string\n}\n\nexport interface RefreshTokenResponse {\n  access: string\n}\n\nexport interface LogoutRequest {\n  refresh: string\n}\n\nexport interface TeamDetails {\n  id: string\n  name: string\n  institution: string\n  poc: any\n  faculty_mentor: {\n    id: string\n    name: string\n  }\n  problem_statement: {\n    id: string\n    title: string\n  }\n  members: Array<{\n    id: string\n    role: string\n    user: {\n      id: string\n      email: string\n      name: string\n    }\n  }>\n}\n\nexport interface POCTeam {\n  id: string\n  name: string\n  institution: string\n  [key: string]: any\n}\n\nexport interface CurrentUser {\n  id?: string\n  email?: string\n  name?: string\n  team_ids?: string[]\n  role?: string\n  [key: string]: any\n}\n\nclass AuthService {\n  private accessTokenKey = ACCESS_TOKEN_KEY\n  private refreshTokenKey = REFRESH_TOKEN_KEY\n\n  private setTokens(access: string, refresh: string) {\n    if (typeof window !== \"undefined\") {\n      localStorage.setItem(this.accessTokenKey, access)\n      localStorage.setItem(this.refreshTokenKey, refresh)\n    }\n  }\n\n  getAccessToken(): string | null {\n    if (typeof window !== \"undefined\") {\n      return localStorage.getItem(this.accessTokenKey)\n    }\n    return null\n  }\n\n  getRefreshToken(): string | null {\n    if (typeof window !== \"undefined\") {\n      return localStorage.getItem(this.refreshTokenKey)\n    }\n    return null\n  }\n\n  clearTokens() {\n    if (typeof window !== \"undefined\") {\n      localStorage.removeItem(this.accessTokenKey)\n      localStorage.removeItem(this.refreshTokenKey)\n    }\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}, retryCount = 0): Promise<T> {\n    const url = `${BASE_URL}${endpoint}`\n    const headers = new Headers(options.headers || {})\n\n    const accessToken = this.getAccessToken()\n    if (accessToken) {\n      headers.set(\"Authorization\", `Bearer ${accessToken}`)\n    }\n\n    const response = await fetch(url, {\n      ...options,\n      headers,\n    })\n\n    if (response.status === 401 && retryCount === 0) {\n      const refreshToken = this.getRefreshToken()\n      if (refreshToken) {\n        try {\n          const newAccessToken = await this.refreshAccessToken(refreshToken)\n          return this.request<T>(endpoint, options, 1)\n        } catch (error) {\n          this.clearTokens()\n          if (typeof window !== \"undefined\") {\n            window.location.href = \"/login\"\n          }\n          throw new Error(\"Session expired. Please login again.\")\n        }\n      }\n    }\n\n    if (!response.ok) {\n      const error = await response.json().catch(() => ({}))\n      throw new Error(error.detail || error.message || `API Error: ${response.status}`)\n    }\n\n    return response.json()\n  }\n\n  getCurrentUser(): CurrentUser | null {\n    if (typeof window === \"undefined\") return null\n    const token = this.getAccessToken()\n    if (!token) return null\n\n    try {\n      const [, payload] = token.split(\".\")\n      if (!payload) return null\n      const json = JSON.parse(this.base64UrlDecode(payload))\n      return json as CurrentUser\n    } catch (e) {\n      return null\n    }\n  }\n\n  private base64UrlDecode(input: string): string {\n    // Convert from base64url to base64\n    let base64 = input.replace(/-/g, \"+\").replace(/_/g, \"/\")\n    // Pad with '=' to make length a multiple of 4\n    const pad = base64.length % 4\n    if (pad) base64 += \"=\".repeat(4 - pad)\n    if (typeof window !== \"undefined\" && typeof window.atob === \"function\") {\n      return decodeURIComponent(\n        Array.prototype.map\n          .call(window.atob(base64), (c: string) => \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2))\n          .join(\"\")\n      )\n    }\n    // Fallback for non-browser environments\n    return Buffer.from(base64, \"base64\").toString(\"utf-8\")\n  }\n\n  async login(request: LoginRequest): Promise<LoginResponse> {\n    const response = await this.request<LoginResponse>(\"/token/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    })\n\n    this.setTokens(response.access, response.refresh)\n    return response\n  }\n\n  private async refreshAccessToken(refreshToken: string): Promise<string> {\n    const response = await this.request<RefreshTokenResponse>(\"/token/refresh/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ refresh: refreshToken }),\n    })\n\n    const accessToken = response.access\n    localStorage.setItem(this.accessTokenKey, accessToken)\n    return accessToken\n  }\n\n  async requestOTP(email: string): Promise<{ detail: string }> {\n    return this.request(\"/auth/send-otp/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ email, purpose: \"first_login\" }),\n    })\n  }\n\n  async verifyOTPAndSetPassword(request: OTPVerifyRequest): Promise<{ detail: string; next: string }> {\n    return this.request(\"/auth/verify-otp/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(request),\n    })\n  }\n\n  async autoLogin(email: string, password: string): Promise<LoginResponse> {\n    return this.login({ email, password })\n  }\n\n  async getTeamDetails(preview = false): Promise<TeamDetails> {\n    const endpoint = preview ? \"/leader/team/?preview=1\" : \"/leader/team/\"\n    return this.request(endpoint)\n  }\n\n  async confirmTeamDetails(): Promise<{ detail: string; next: string }> {\n    return this.request(\"/leader/team/confirm/\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({}),\n    })\n  }\n\n  async getPOCTeams(): Promise<POCTeam[]> {\n    return this.request(\"/poc/teams/\")\n  }\n\n  async getPOCTeamDetail(teamId: string): Promise<TeamDetails> {\n    return this.request(`/poc/teams/${teamId}/`)\n  }\n\n  async logout(): Promise<{ detail: string }> {\n    const refreshToken = this.getRefreshToken()\n    if (!refreshToken) {\n      this.clearTokens()\n      return { detail: \"Logged out\" }\n    }\n\n    try {\n      const response = await this.request<{ detail: string }>(\"/auth/logout/\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ refresh: refreshToken }),\n      })\n      this.clearTokens()\n      return response\n    } catch (error) {\n      this.clearTokens()\n      return { detail: \"Logged out\" }\n    }\n  }\n\n  async logoutAll(): Promise<{ detail: string }> {\n    try {\n      const response = await this.request<{ detail: string }>(\"/auth/logout_all/\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n      })\n      this.clearTokens()\n      return response\n    } catch (error) {\n      this.clearTokens()\n      return { detail: \"Logged out from all devices\" }\n    }\n  }\n}\n\nexport const authService = new AuthService()\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///D:/Jaswanth/Downloads/smart-india-hackathon-app/lib/requests-service.ts"],"sourcesContent":["/**\r\n * Requests Service API Client\r\n * Handles all communication with the Requests microservice\r\n */\r\n\r\nimport { authService } from \"./auth-service\"\r\n\r\nconst BASE_URL = process.env.NEXT_PUBLIC_REQUESTS_SERVICE_URL || \"http://127.0.0.1:8001/api\"\r\nconst ACCESS_TOKEN_KEY = \"sih_access_token\"\r\n\r\nexport interface BOMItem {\r\n  id?: number\r\n  item_name: string\r\n  quantity: number\r\n}\r\n\r\nexport interface AdditionalItem {\r\n  id?: number\r\n  item_name: string\r\n  quantity: number\r\n}\r\n\r\nexport interface FabricationDetails {\r\n  fab_type: \"3D\" | \"LASER\" | \"OTHER\"\r\n  name: string\r\n  file?: string\r\n}\r\n\r\nexport interface RequestData {\r\n  id: number\r\n  team_id: string\r\n  submitted_by_id: string\r\n  category: \"BOM\" | \"ADDITIONAL\" | \"FABRICATION\"\r\n  status: \"Submitted\" | \"Processing\" | \"Issued\" | \"Cannot be Processed\"\r\n  notes: string\r\n  created_at: string\r\n  updated_at: string\r\n  position?: number\r\n  bom_items: BOMItem[]\r\n  additional_items: AdditionalItem[]\r\n  fabrication: FabricationDetails | null\r\n}\r\n\r\nexport interface ListRequestsParams {\r\n  category?: \"BOM\" | \"ADDITIONAL\" | \"FABRICATION\"\r\n  status?: \"Submitted\" | \"Processing\" | \"Issued\" | \"Cannot be Processed\"\r\n  fab_type?: \"3D\" | \"LASER\" | \"OTHER\"\r\n  team_id?: string\r\n  search?: string\r\n  ordering?: string\r\n  page?: number\r\n}\r\n\r\nexport interface RequestsListResponse {\r\n  count: number\r\n  next: string | null\r\n  previous: string | null\r\n  results: RequestData[]\r\n}\r\n\r\nasync function apiCall<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\r\n  const url = `${BASE_URL}${endpoint}`\r\n  const headers = new Headers(options.headers || {})\r\n\r\n  const accessToken = authService.getAccessToken()\r\n  if (accessToken && !headers.has(\"Authorization\")) {\r\n    headers.set(\"Authorization\", `Bearer ${accessToken}`)\r\n  }\r\n\r\n  let response = await fetch(url, {\r\n    ...options,\r\n    headers,\r\n  })\r\n\r\n  if (response.status === 401) {\r\n    const refreshToken = authService.getRefreshToken()\r\n    if (refreshToken) {\r\n      try {\r\n        const refreshResponse = await fetch(`${BASE_URL}/token/refresh/`, {\r\n          method: \"POST\",\r\n          headers: { \"Content-Type\": \"application/json\" },\r\n          body: JSON.stringify({ refresh: refreshToken }),\r\n        })\r\n\r\n        if (refreshResponse.ok) {\r\n          const { access } = await refreshResponse.json()\r\n          localStorage.setItem(ACCESS_TOKEN_KEY, access)\r\n          headers.set(\"Authorization\", `Bearer ${access}`)\r\n          response = await fetch(url, { ...options, headers })\r\n        }\r\n      } catch (error) {\r\n        authService.clearTokens()\r\n        window.location.href = \"/login\"\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}))\r\n    throw new Error(error.detail || error.message || `API Error: ${response.status}`)\r\n  }\r\n\r\n  return response.json()\r\n}\r\n\r\nexport const requestsService = {\r\n  // List requests with filters\r\n  async listRequests(params?: ListRequestsParams): Promise<RequestsListResponse> {\r\n    const queryParams = new URLSearchParams()\r\n    if (params?.category) queryParams.append(\"category\", params.category)\r\n    if (params?.status) queryParams.append(\"status\", params.status)\r\n    if (params?.fab_type) queryParams.append(\"fab_type\", params.fab_type)\r\n    if (params?.team_id) queryParams.append(\"team_id\", params.team_id)\r\n    if (params?.search) queryParams.append(\"search\", params.search)\r\n    if (params?.ordering) queryParams.append(\"ordering\", params.ordering)\r\n    if (params?.page) queryParams.append(\"page\", params.page.toString())\r\n\r\n    const endpoint = `/requests/?${queryParams.toString()}`\r\n    return apiCall<RequestsListResponse>(endpoint)\r\n  },\r\n\r\n  // Get queue snapshot\r\n  async getQueueSnapshot(includePositions = true): Promise<RequestsListResponse> {\r\n    const endpoint = `/requests/queue/?include_positions=${includePositions}`\r\n    return apiCall<RequestsListResponse>(endpoint)\r\n  },\r\n\r\n  // Get single request\r\n  async getRequest(id: number): Promise<RequestData> {\r\n    return apiCall<RequestData>(`/requests/${id}/`)\r\n  },\r\n\r\n  // Create BOM request\r\n  async createBOMRequest(teamId: string, notes: string, items: BOMItem[]): Promise<RequestData> {\r\n    return apiCall<RequestData>(\"/requests/\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        team_id: teamId,\r\n        category: \"BOM\",\r\n        notes,\r\n        bom_items: items,\r\n      }),\r\n    })\r\n  },\r\n\r\n  // Create Additional request\r\n  async createAdditionalRequest(teamId: string, notes: string, items: AdditionalItem[]): Promise<RequestData> {\r\n    return apiCall<RequestData>(\"/requests/\", {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        team_id: teamId,\r\n        category: \"ADDITIONAL\",\r\n        notes,\r\n        additional_items: items,\r\n      }),\r\n    })\r\n  },\r\n\r\n  // Create Fabrication request with file\r\n  async createFabricationRequest(\r\n    teamId: string,\r\n    notes: string,\r\n    fabDetails: FabricationDetails,\r\n    file?: File,\r\n  ): Promise<RequestData> {\r\n    const formData = new FormData()\r\n    formData.append(\"team_id\", teamId)\r\n    formData.append(\"category\", \"FABRICATION\")\r\n    formData.append(\"notes\", notes)\r\n    formData.append(\"fabrication\", JSON.stringify(fabDetails))\r\n    if (file) {\r\n      formData.append(\"file\", file)\r\n    }\r\n\r\n    const accessToken = authService.getAccessToken()\r\n    const headers = new Headers()\r\n    if (accessToken) {\r\n      headers.set(\"Authorization\", `Bearer ${accessToken}`)\r\n    }\r\n\r\n    const response = await fetch(`${BASE_URL}/requests/`, {\r\n      method: \"POST\",\r\n      headers,\r\n      body: formData,\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error = await response.json().catch(() => ({}))\r\n      throw new Error(error.detail || error.message || `API Error: ${response.status}`)\r\n    }\r\n\r\n    return response.json()\r\n  },\r\n\r\n  // Change request status\r\n  async changeRequestStatus(id: number, toStatus: string, note?: string): Promise<RequestData> {\r\n    return apiCall<RequestData>(`/requests/${id}/change_status/`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        to_status: toStatus,\r\n        note: note || \"\",\r\n      }),\r\n    })\r\n  },\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 357, "column": 0}, "map": {"version":3,"sources":["file:///D:/Jaswanth/Downloads/smart-india-hackathon-app/hooks/use-requests-ws.ts"],"sourcesContent":["\"use client\"\r\n\r\n/**\r\n * WebSocket hook for real-time requests queue updates\r\n * Handles automatic reconnection with exponential backoff\r\n */\r\n\r\nimport { useEffect, useRef, useCallback } from \"react\"\r\nimport { authService } from \"@/lib/auth-service\"\r\n\r\n// Derive backend origin for WebSocket from NEXT_PUBLIC_REQUESTS_SERVICE_URL if provided.\r\n// Fallback to current window.location.origin (same host/port as frontend) if not set.\r\nfunction getBackendWsOrigin(): string | null {\r\n  const envBase = process.env.NEXT_PUBLIC_REQUESTS_SERVICE_URL\r\n  if (envBase) {\r\n    try {\r\n      const u = new URL(envBase)\r\n      return u.origin // strip path (/api)\r\n    } catch (_) {\r\n      // ignore malformed; fallback below\r\n    }\r\n  }\r\n  if (typeof window !== \"undefined\") return window.location.origin\r\n  return null\r\n}\r\n\r\nexport interface WSMessage {\r\n  event: \"request_created\" | \"request_updated\" | \"state_transition\"\r\n  request?: any\r\n  request_id?: number\r\n  from?: string\r\n  to?: string\r\n  changed_by?: string\r\n  timestamp?: string\r\n  note?: string\r\n}\r\n\r\nconst INITIAL_BACKOFF = 1000\r\nconst MAX_BACKOFF = 30000\r\n\r\nexport function useRequestsWS(onEvent: (message: WSMessage) => void) {\r\n  const wsRef = useRef<WebSocket | null>(null)\r\n  const backoffRef = useRef(INITIAL_BACKOFF)\r\n  const closedManuallyRef = useRef(false)\r\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout | undefined>(undefined)\r\n\r\n  const getWsUrl = useCallback(() => {\r\n    const token = authService.getAccessToken()\r\n    if (!token) return null\r\n\r\n    const origin = getBackendWsOrigin()\r\n    if (!origin) return null\r\n\r\n    const secure = origin.startsWith(\"https://\")\r\n    const wsProtocol = secure ? \"wss\" : \"ws\"\r\n    // Convert origin (http[s]://host[:port]) to ws(s)://host[:port]\r\n    const hostPort = origin.replace(/^https?:\\/\\//, \"\")\r\n    return `${wsProtocol}://${hostPort}/ws/requests/?token=${token}`\r\n  }, [])\r\n\r\n  const connect = useCallback(() => {\r\n    const wsUrl = getWsUrl()\r\n    if (!wsUrl) return\r\n\r\n    try {\r\n      const ws = new WebSocket(wsUrl)\r\n      wsRef.current = ws\r\n\r\n      ws.onopen = () => {\r\n        console.log(\"[v0] WebSocket connected\")\r\n        backoffRef.current = INITIAL_BACKOFF\r\n      }\r\n\r\n      ws.onmessage = (event) => {\r\n        try {\r\n          const message = JSON.parse(event.data)\r\n          onEvent(message)\r\n        } catch (error) {\r\n          console.error(\"[v0] Failed to parse WS message:\", error)\r\n        }\r\n      }\r\n\r\n      ws.onclose = (evt) => {\r\n        console.log(\"[v0] WebSocket closed\", evt.code, evt.reason || \"\")\r\n        if (closedManuallyRef.current) return\r\n\r\n        // Schedule reconnect with exponential backoff\r\n        reconnectTimeoutRef.current = setTimeout(() => {\r\n          console.log(\"[v0] Attempting to reconnect with backoff:\", backoffRef.current)\r\n          connect()\r\n          backoffRef.current = Math.min(backoffRef.current * 2, MAX_BACKOFF)\r\n        }, backoffRef.current)\r\n      }\r\n\r\n      ws.onerror = (error) => {\r\n        console.error(\"[v0] WebSocket error:\", error)\r\n      }\r\n    } catch (error) {\r\n      console.error(\"[v0] Failed to create WebSocket:\", error)\r\n    }\r\n  }, [getWsUrl, onEvent])\r\n\r\n  useEffect(() => {\r\n    closedManuallyRef.current = false\r\n    connect()\r\n\r\n    return () => {\r\n      closedManuallyRef.current = true\r\n      if (reconnectTimeoutRef.current) {\r\n        clearTimeout(reconnectTimeoutRef.current)\r\n      }\r\n      if (wsRef.current) {\r\n        wsRef.current.close()\r\n      }\r\n    }\r\n  }, [connect])\r\n\r\n  return {\r\n    isConnected: wsRef.current?.readyState === WebSocket.OPEN,\r\n    close: () => {\r\n      closedManuallyRef.current = true\r\n      wsRef.current?.close()\r\n    },\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;;;CAGC,GAED;AACA;AARA;;;AAUA,yFAAyF;AACzF,sFAAsF;AACtF,SAAS;IACP,MAAM,UAAU,QAAQ,GAAG,CAAC,gCAAgC;IAC5D,IAAI,SAAS;QACX,IAAI;YACF,MAAM,IAAI,IAAI,IAAI;YAClB,OAAO,EAAE,MAAM,CAAC,oBAAoB;;QACtC,EAAE,OAAO,GAAG;QACV,mCAAmC;QACrC;IACF;IACA;;IACA,OAAO;AACT;AAaA,MAAM,kBAAkB;AACxB,MAAM,cAAc;AAEb,SAAS,cAAc,OAAqC;IACjE,MAAM,QAAQ,IAAA,+MAAM,EAAmB;IACvC,MAAM,aAAa,IAAA,+MAAM,EAAC;IAC1B,MAAM,oBAAoB,IAAA,+MAAM,EAAC;IACjC,MAAM,sBAAsB,IAAA,+MAAM,EAA6B;IAE/D,MAAM,WAAW,IAAA,oNAAW,EAAC;QAC3B,MAAM,QAAQ,qIAAW,CAAC,cAAc;QACxC,IAAI,CAAC,OAAO,OAAO;QAEnB,MAAM,SAAS;QACf,IAAI,CAAC,QAAQ,OAAO;QAEpB,MAAM,SAAS,OAAO,UAAU,CAAC;QACjC,MAAM,aAAa,SAAS,QAAQ;QACpC,gEAAgE;QAChE,MAAM,WAAW,OAAO,OAAO,CAAC,gBAAgB;QAChD,OAAO,GAAG,WAAW,GAAG,EAAE,SAAS,oBAAoB,EAAE,OAAO;IAClE,GAAG,EAAE;IAEL,MAAM,UAAU,IAAA,oNAAW,EAAC;QAC1B,MAAM,QAAQ;QACd,IAAI,CAAC,OAAO;QAEZ,IAAI;YACF,MAAM,KAAK,IAAI,UAAU;YACzB,MAAM,OAAO,GAAG;YAEhB,GAAG,MAAM,GAAG;gBACV,QAAQ,GAAG,CAAC;gBACZ,WAAW,OAAO,GAAG;YACvB;YAEA,GAAG,SAAS,GAAG,CAAC;gBACd,IAAI;oBACF,MAAM,UAAU,KAAK,KAAK,CAAC,MAAM,IAAI;oBACrC,QAAQ;gBACV,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,oCAAoC;gBACpD;YACF;YAEA,GAAG,OAAO,GAAG,CAAC;gBACZ,QAAQ,GAAG,CAAC,yBAAyB,IAAI,IAAI,EAAE,IAAI,MAAM,IAAI;gBAC7D,IAAI,kBAAkB,OAAO,EAAE;gBAE/B,8CAA8C;gBAC9C,oBAAoB,OAAO,GAAG,WAAW;oBACvC,QAAQ,GAAG,CAAC,8CAA8C,WAAW,OAAO;oBAC5E;oBACA,WAAW,OAAO,GAAG,KAAK,GAAG,CAAC,WAAW,OAAO,GAAG,GAAG;gBACxD,GAAG,WAAW,OAAO;YACvB;YAEA,GAAG,OAAO,GAAG,CAAC;gBACZ,QAAQ,KAAK,CAAC,yBAAyB;YACzC;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,oCAAoC;QACpD;IACF,GAAG;QAAC;QAAU;KAAQ;IAEtB,IAAA,kNAAS,EAAC;QACR,kBAAkB,OAAO,GAAG;QAC5B;QAEA,OAAO;YACL,kBAAkB,OAAO,GAAG;YAC5B,IAAI,oBAAoB,OAAO,EAAE;gBAC/B,aAAa,oBAAoB,OAAO;YAC1C;YACA,IAAI,MAAM,OAAO,EAAE;gBACjB,MAAM,OAAO,CAAC,KAAK;YACrB;QACF;IACF,GAAG;QAAC;KAAQ;IAEZ,OAAO;QACL,aAAa,MAAM,OAAO,EAAE,eAAe,UAAU,IAAI;QACzD,OAAO;YACL,kBAAkB,OAAO,GAAG;YAC5B,MAAM,OAAO,EAAE;QACjB;IACF;AACF"}},
    {"offset": {"line": 469, "column": 0}, "map": {"version":3,"sources":["file:///D:/Jaswanth/Downloads/smart-india-hackathon-app/components/requests/request-progress.tsx"],"sourcesContent":["\"use client\"\r\nimport React from \"react\"\r\n\r\ninterface RequestProgressProps {\r\n  status: string\r\n}\r\n\r\nconst steps = [\"Submitted\", \"Processing\", \"Issued\"]\r\n\r\nexport function RequestProgress({ status }: RequestProgressProps) {\r\n  return (\r\n    <div className=\"flex items-center gap-2\" aria-label=\"Request status progress\">\r\n      {steps.map((step, idx) => {\r\n        const currentIndex = steps.indexOf(status)\r\n        const done = currentIndex >= idx\r\n        const active = currentIndex === idx\r\n        return (\r\n          <React.Fragment key={step}>\r\n            <div\r\n              className={`flex flex-col items-center text-[10px] font-medium ${done ? \"text-[#002449]\" : \"text-gray-400\"}`}\r\n            >\r\n              <div\r\n                className={`h-2.5 w-2.5 rounded-full ${done ? (active ? \"bg-[#f75700]\" : \"bg-[#002449]\") : \"bg-gray-300\"}`}\r\n              />\r\n              <span className=\"mt-1 tracking-wide\">{step}</span>\r\n            </div>\r\n            {idx < steps.length - 1 && (\r\n              <div\r\n                className={`h-px w-6 ${currentIndex > idx ? \"bg-[#002449]\" : \"bg-gray-300\"}`}\r\n                aria-hidden=\"true\"\r\n              />\r\n            )}\r\n          </React.Fragment>\r\n        )\r\n      })}\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AADA;;;AAOA,MAAM,QAAQ;IAAC;IAAa;IAAc;CAAS;AAE5C,SAAS,gBAAgB,EAAE,MAAM,EAAwB;IAC9D,qBACE,8OAAC;QAAI,WAAU;QAA0B,cAAW;kBACjD,MAAM,GAAG,CAAC,CAAC,MAAM;YAChB,MAAM,eAAe,MAAM,OAAO,CAAC;YACnC,MAAM,OAAO,gBAAgB;YAC7B,MAAM,SAAS,iBAAiB;YAChC,qBACE,8OAAC,gNAAK,CAAC,QAAQ;;kCACb,8OAAC;wBACC,WAAW,CAAC,mDAAmD,EAAE,OAAO,mBAAmB,iBAAiB;;0CAE5G,8OAAC;gCACC,WAAW,CAAC,yBAAyB,EAAE,OAAQ,SAAS,iBAAiB,iBAAkB,eAAe;;;;;;0CAE5G,8OAAC;gCAAK,WAAU;0CAAsB;;;;;;;;;;;;oBAEvC,MAAM,MAAM,MAAM,GAAG,mBACpB,8OAAC;wBACC,WAAW,CAAC,SAAS,EAAE,eAAe,MAAM,iBAAiB,eAAe;wBAC5E,eAAY;;;;;;;eAZG;;;;;QAiBzB;;;;;;AAGN"}},
    {"offset": {"line": 542, "column": 0}, "map": {"version":3,"sources":["file:///D:/Jaswanth/Downloads/smart-india-hackathon-app/components/requests/request-filters.tsx"],"sourcesContent":["\"use client\"\r\nimport React from \"react\"\r\n\r\ninterface RequestFiltersProps {\r\n  currentStatus: string | null\r\n  onStatusChange: (s: string | null) => void\r\n  search: string\r\n  onSearch: (q: string) => void\r\n  category: string | null\r\n  onCategoryChange: (c: string | null) => void\r\n}\r\n\r\nconst statusOptions = [\"Submitted\", \"Processing\", \"Issued\", \"Cannot be Processed\"]\r\nconst categoryOptions = [\"BOM\", \"ADDITIONAL\", \"FABRICATION\"]\r\n\r\nexport function RequestFilters({\r\n  currentStatus,\r\n  onStatusChange,\r\n  search,\r\n  onSearch,\r\n  category,\r\n  onCategoryChange,\r\n}: RequestFiltersProps) {\r\n  return (\r\n    <div className=\"flex flex-col gap-4 md:flex-row md:items-center md:justify-between\">\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        <button\r\n          onClick={() => onStatusChange(null)}\r\n          className={`px-3 py-1.5 rounded-full text-xs font-semibold border transition-colors ${\r\n            currentStatus === null ? \"bg-[#002449] text-white border-[#002449]\" : \"border-gray-300 text-gray-600 hover:bg-gray-50\"\r\n          }`}\r\n        >\r\n          All\r\n        </button>\r\n        {statusOptions.map((st) => (\r\n          <button\r\n            key={st}\r\n            onClick={() => onStatusChange(st)}\r\n            className={`px-3 py-1.5 rounded-full text-xs font-semibold border transition-colors ${\r\n              currentStatus === st ? \"bg-[#f75700] text-white border-[#f75700]\" : \"border-gray-300 text-gray-600 hover:bg-gray-50\"\r\n            }`}\r\n          >\r\n            {st}\r\n          </button>\r\n        ))}\r\n      </div>\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        <div className=\"relative\">\r\n          <input\r\n            type=\"text\"\r\n            value={search}\r\n            onChange={(e) => onSearch(e.target.value)}\r\n            placeholder=\"Search notes...\"\r\n            className=\"pl-3 pr-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#002449] w-48\"\r\n          />\r\n        </div>\r\n        <select\r\n          value={category || \"\"}\r\n          onChange={(e) => onCategoryChange(e.target.value || null)}\r\n          className=\"px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#002449]\"\r\n        >\r\n          <option value=\"\">All Categories</option>\r\n          {categoryOptions.map((c) => (\r\n            <option key={c} value={c}>\r\n              {c}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;AAYA,MAAM,gBAAgB;IAAC;IAAa;IAAc;IAAU;CAAsB;AAClF,MAAM,kBAAkB;IAAC;IAAO;IAAc;CAAc;AAErD,SAAS,eAAe,EAC7B,aAAa,EACb,cAAc,EACd,MAAM,EACN,QAAQ,EACR,QAAQ,EACR,gBAAgB,EACI;IACpB,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,SAAS,IAAM,eAAe;wBAC9B,WAAW,CAAC,wEAAwE,EAClF,kBAAkB,OAAO,6CAA6C,kDACtE;kCACH;;;;;;oBAGA,cAAc,GAAG,CAAC,CAAC,mBAClB,8OAAC;4BAEC,SAAS,IAAM,eAAe;4BAC9B,WAAW,CAAC,wEAAwE,EAClF,kBAAkB,KAAK,6CAA6C,kDACpE;sCAED;2BANI;;;;;;;;;;;0BAUX,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;kCACb,cAAA,8OAAC;4BACC,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;4BACxC,aAAY;4BACZ,WAAU;;;;;;;;;;;kCAGd,8OAAC;wBACC,OAAO,YAAY;wBACnB,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK,IAAI;wBACpD,WAAU;;0CAEV,8OAAC;gCAAO,OAAM;0CAAG;;;;;;4BAChB,gBAAgB,GAAG,CAAC,CAAC,kBACpB,8OAAC;oCAAe,OAAO;8CACpB;mCADU;;;;;;;;;;;;;;;;;;;;;;;AAQzB"}},
    {"offset": {"line": 656, "column": 0}, "map": {"version":3,"sources":["file:///D:/Jaswanth/Downloads/smart-india-hackathon-app/app/requests/page.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useEffect, useState, useCallback, useMemo } from \"react\"\r\nimport { useRouter } from \"next/navigation\"\r\nimport Link from \"next/link\"\r\nimport { authService } from \"@/lib/auth-service\"\r\nimport { requestsService, type RequestData } from \"@/lib/requests-service\"\r\nimport { useRequestsWS, type WSMessage } from \"@/hooks/use-requests-ws\"\r\nimport { RequestProgress } from \"@/components/requests/request-progress\"\r\nimport { RequestFilters } from \"@/components/requests/request-filters\"\r\n\r\nexport default function RequestsPage() {\r\n  const router = useRouter()\r\n  const [requests, setRequests] = useState<RequestData[]>([])\r\n  const [statusFilter, setStatusFilter] = useState<string | null>(null)\r\n  const [searchQuery, setSearchQuery] = useState(\"\")\r\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [error, setError] = useState(\"\")\r\n  const [userTeams, setUserTeams] = useState<string[]>([])\r\n\r\n  const user = authService.getCurrentUser()\r\n\r\n  useEffect(() => {\r\n    const token = authService.getAccessToken()\r\n    if (!token) {\r\n      router.push(\"/login\")\r\n      return\r\n    }\r\n    if (user?.team_ids) setUserTeams(user.team_ids)\r\n  }, [user, router])\r\n\r\n  const fetchRequests = useCallback(async () => {\r\n    try {\r\n      setLoading(true)\r\n      setError(\"\")\r\n      if (!userTeams.length) {\r\n        setRequests([])\r\n        setLoading(false)\r\n        return\r\n      }\r\n      const response = await requestsService.listRequests({ ordering: \"-created_at\" })\r\n      const filtered = response.results.filter((r: RequestData) => userTeams.includes(r.team_id))\r\n      setRequests(filtered)\r\n    } catch (err) {\r\n      console.error(\"[requests] Error fetching requests:\", err)\r\n      setError(err instanceof Error ? err.message : \"Failed to fetch requests\")\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }, [userTeams])\r\n\r\n  const handleWsEvent = useCallback(\r\n    (message: WSMessage) => {\r\n      if (!userTeams.length) return\r\n      if (message.event === \"request_created\" || message.event === \"request_updated\") {\r\n        if (userTeams.includes(message.request?.team_id)) {\r\n          setRequests((prev) => {\r\n            const filtered = prev.filter((r) => r.id !== message.request?.id)\r\n            return [message.request, ...filtered].sort((a, b) => new Date(b.created_at).getTime() - new Date(a.created_at).getTime())\r\n          })\r\n        }\r\n      } else if (message.event === \"state_transition\") {\r\n        setRequests((prev) => prev.map((r) => (r.id === message.request_id ? { ...r, status: message.to as any } : r)))\r\n      }\r\n    },\r\n    [userTeams],\r\n  )\r\n\r\n  useRequestsWS(handleWsEvent)\r\n\r\n  useEffect(() => {\r\n    if (userTeams.length > 0) fetchRequests()\r\n  }, [userTeams, fetchRequests])\r\n\r\n  const filtered = useMemo(\r\n    () =>\r\n      requests.filter((r) => {\r\n        if (statusFilter && r.status !== statusFilter) return false\r\n        if (categoryFilter && r.category !== categoryFilter) return false\r\n        if (searchQuery && !(r.notes || \"Untitled\").toLowerCase().includes(searchQuery.toLowerCase())) return false\r\n        return true\r\n      }),\r\n    [requests, statusFilter, categoryFilter, searchQuery],\r\n  )\r\n\r\n  const counts = useMemo(() => {\r\n    const base = { Submitted: 0, Processing: 0, Issued: 0, Cannot: 0 }\r\n    requests.forEach((r) => {\r\n      if (r.status === \"Submitted\") base.Submitted++\r\n      else if (r.status === \"Processing\") base.Processing++\r\n      else if (r.status === \"Issued\") base.Issued++\r\n      else if (r.status === \"Cannot be Processed\") base.Cannot++\r\n    })\r\n    return base\r\n  }, [requests])\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-white\">\r\n      <div className=\"max-w-7xl mx-auto px-4 pt-6 pb-4 flex flex-col gap-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <h1 className=\"text-2xl font-bold\" style={{ color: \"#002449\" }}>\r\n            My Requests\r\n          </h1>\r\n          <Link\r\n            href=\"/requests/new\"\r\n            className=\"px-4 py-2 text-white font-medium rounded-lg transition-opacity\"\r\n            style={{ backgroundColor: \"#f75700\" }}\r\n            onMouseEnter={(e) => (e.currentTarget.style.opacity = \"0.9\")}\r\n            onMouseLeave={(e) => (e.currentTarget.style.opacity = \"1\")}\r\n          >\r\n            New Request\r\n          </Link>\r\n        </div>\r\n        <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\r\n          <div className=\"p-3 rounded-lg border border-gray-200 bg-white flex flex-col\">\r\n            <span className=\"text-[11px] uppercase tracking-wide text-gray-500\">Submitted</span>\r\n            <span className=\"text-xl font-bold\" style={{ color: \"#f75700\" }}>{counts.Submitted}</span>\r\n          </div>\r\n          <div className=\"p-3 rounded-lg border border-gray-200 bg-white flex flex-col\">\r\n            <span className=\"text-[11px] uppercase tracking-wide text-gray-500\">Processing</span>\r\n            <span className=\"text-xl font-bold\" style={{ color: \"#002449\" }}>{counts.Processing}</span>\r\n          </div>\r\n          <div className=\"p-3 rounded-lg border border-gray-200 bg-white flex flex-col\">\r\n            <span className=\"text-[11px] uppercase tracking-wide text-gray-500\">Issued</span>\r\n            <span className=\"text-xl font-bold\" style={{ color: \"#078e31\" }}>{counts.Issued}</span>\r\n          </div>\r\n          <div className=\"p-3 rounded-lg border border-gray-200 bg-white flex flex-col\">\r\n            <span className=\"text-[11px] uppercase tracking-wide text-gray-500\">Cannot</span>\r\n            <span className=\"text-xl font-bold\" style={{ color: \"#c62828\" }}>{counts.Cannot}</span>\r\n          </div>\r\n        </div>\r\n        <RequestFilters\r\n          currentStatus={statusFilter}\r\n          onStatusChange={setStatusFilter}\r\n          search={searchQuery}\r\n          onSearch={setSearchQuery}\r\n          category={categoryFilter}\r\n          onCategoryChange={setCategoryFilter}\r\n        />\r\n      </div>\r\n      <main className=\"max-w-7xl mx-auto px-4 pb-12\">\r\n        {error && (\r\n          <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mb-6\">\r\n            <p className=\"text-red-800\">{error}</p>\r\n          </div>\r\n        )}\r\n        {loading ? (\r\n          <div className=\"text-center py-12\">\r\n            <p className=\"text-gray-600\">Loading requests...</p>\r\n          </div>\r\n        ) : filtered.length === 0 ? (\r\n          <div className=\"text-center py-12\">\r\n            <p className=\"text-gray-600 mb-4\">No requests yet</p>\r\n            <Link\r\n              href=\"/requests/new\"\r\n              className=\"inline-block px-4 py-2 text-white font-medium rounded-lg\"\r\n              style={{ backgroundColor: \"#f75700\" }}\r\n            >\r\n              Create Your First Request\r\n            </Link>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\r\n            {filtered.map((request) => (\r\n              <Link key={request.id} href={`/requests/${request.id}`}>\r\n                <div className=\"bg-white border border-gray-200 rounded-lg p-5 hover:shadow-lg transition-shadow cursor-pointer h-full flex flex-col gap-3\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span\r\n                      className=\"inline-block px-3 py-1 text-xs font-semibold text-white rounded-full\"\r\n                      style={{\r\n                        backgroundColor:\r\n                          request.category === \"BOM\"\r\n                            ? \"#002449\"\r\n                            : request.category === \"ADDITIONAL\"\r\n                              ? \"#007367\"\r\n                              : \"#f75700\",\r\n                      }}\r\n                    >\r\n                      {request.category}\r\n                    </span>\r\n                    <RequestProgress status={request.status} />\r\n                  </div>\r\n                  <h3 className=\"text-sm font-semibold text-gray-900\">{request.notes || \"Untitled\"}</h3>\r\n                  {request.fabrication && (\r\n                    <p className=\"text-sm text-gray-600 mb-2\">\r\n                      {request.fabrication.fab_type} - {request.fabrication.name}\r\n                    </p>\r\n                  )}\r\n                  {request.bom_items?.length > 0 && (\r\n                    <p className=\"text-xs text-gray-500\">{request.bom_items.length} items</p>\r\n                  )}\r\n                  <div className=\"flex items-center justify-between mt-auto\">\r\n                    <p className=\"text-[11px] text-gray-500\">{new Date(request.created_at).toLocaleDateString()}</p>\r\n                    <span\r\n                      className=\"px-2 py-1 text-[10px] font-semibold rounded-full\"\r\n                      style={{\r\n                        backgroundColor:\r\n                          request.status === \"Submitted\"\r\n                            ? \"#f0e0c1\"\r\n                            : request.status === \"Processing\"\r\n                              ? \"#e3f2fd\"\r\n                              : request.status === \"Issued\"\r\n                                ? \"#e8f5e9\"\r\n                                : \"#ffebee\",\r\n                        color:\r\n                          request.status === \"Submitted\"\r\n                            ? \"#f75700\"\r\n                            : request.status === \"Processing\"\r\n                              ? \"#002449\"\r\n                              : request.status === \"Issued\"\r\n                                ? \"#078e31\"\r\n                                : \"#c62828\",\r\n                      }}\r\n                    >\r\n                      {request.status}\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n              </Link>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </main>\r\n    </div>\r\n  )\r\n}"],"names":[],"mappings":"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"}}]
}