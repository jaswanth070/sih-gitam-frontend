(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88771,47750,e=>{"use strict";var t=e.i(14077);e.i(60164);let s="http://127.0.0.1:8001",a=`${s}/requests/api`;function r(e){let t=e.replace(/\/+$/,"");return t?(t.startsWith("/")||(t=`/${t}`),t.endsWith("/requests/api"))?t:t.endsWith("/requests")?`${t}/api`:t.endsWith("/api")?t.replace(/\/api$/,"/requests/api"):`${t}/requests/api`:"/requests/api"}function i(e){let t=r(e);return"/requests/api"===t?"/requests":t.replace(/\/api$/,"")||"/requests"}function n(){let e="https://sih.jaswanthmadiya.tech/requests/";if(e.startsWith("/"))return r(e);try{let t=new URL(e);return t.pathname=r(t.pathname),`${t.origin}${t.pathname}`}catch(e){return console.warn("[ws-url] invalid NEXT_PUBLIC_REQUESTS_SERVICE_URL, using default",e),a}}function d(e){try{let t=new URL("wss://sih.jaswanthmadiya.tech/ws/requests");return t.searchParams.set("token",e),t.toString()}catch(e){console.warn("[ws-url] invalid NEXT_PUBLIC_REQUESTS_WS_URL, falling back",e)}let t="https://sih.jaswanthmadiya.tech/requests/",a="",r="/requests";if(t.startsWith("http"))try{let e=new URL(t);a=e.origin,r=i(e.pathname)}catch(e){console.warn("[ws-url] invalid NEXT_PUBLIC_REQUESTS_SERVICE_URL, using defaults",e)}else r=i(t);a||(a=s);let n=a.startsWith("https://"),d=a.replace(/^https?:\/\//,""),l=`${r}/ws/requests/`;return(l=l.replace(/\/+/g,"/")).startsWith("/")||(l=`/${l}`),`${n?"wss":"ws"}://${d}${l}?token=${encodeURIComponent(e)}`}e.s(["buildRequestsBaseUrl",()=>n,"buildRequestsWsUrl",()=>d],47750);let l=n();async function c(e,s={}){let a=`${l}${e}`,r=new Headers(s.headers||{}),i=t.authService.getAccessToken();i&&!r.has("Authorization")&&r.set("Authorization",`Bearer ${i}`);let n=await fetch(a,{...s,headers:r});if(401===n.status){let e=t.authService.getRefreshToken();if(e)try{let t=await fetch(`${l}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:e})});if(t.ok){let{access:e}=await t.json();localStorage.setItem("sih_access_token",e),r.set("Authorization",`Bearer ${e}`),n=await fetch(a,{...s,headers:r})}}catch(e){t.authService.clearTokens(),window.location.href="/login"}}if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.detail||e.message||`API Error: ${n.status}`)}return n.json()}e.s(["requestsService",0,{async listRequests(e){let t=new URLSearchParams;return e?.category&&t.append("category",e.category),e?.status&&t.append("status",e.status),e?.fab_type&&t.append("fab_type",e.fab_type),e?.team_id&&t.append("team_id",e.team_id),e?.search&&t.append("search",e.search),e?.ordering&&t.append("ordering",e.ordering),e?.page&&t.append("page",e.page.toString()),c(`/requests/?${t.toString()}`)},getQueueSnapshot:async(e=!0)=>c(`/requests/queue/?include_positions=${e}`),async getFilteredQueueSnapshot(e){let t=new URLSearchParams;return e.category&&t.append("category",e.category),e.status&&t.append("status",e.status),e.fab_type&&t.append("fab_type",e.fab_type),void 0!==e.include_positions&&t.append("include_positions",e.include_positions?"true":"false"),e.page&&t.append("page",e.page.toString()),e.page_size&&t.append("page_size",e.page_size.toString()),c(`/requests/queue/?${t.toString()}`)},getRequest:async e=>c(`/requests/${e}/`),createBOMRequest:async(e,t,s)=>c("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:e,category:"BOM",notes:t,bom_items:s})}),createAdditionalRequest:async(e,t,s)=>c("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:e,category:"ADDITIONAL",notes:t,additional_items:s})}),async createFabricationRequest(e,s,a,r){let i=new FormData;i.append("team_id",e),i.append("category","FABRICATION"),i.append("notes",s),i.append("fabrication",JSON.stringify(a)),r&&i.append("file",r);let n=t.authService.getAccessToken(),d=new Headers;n&&d.set("Authorization",`Bearer ${n}`);let c=await fetch(`${l}/requests/`,{method:"POST",headers:d,body:i});if(!c.ok){let e=await c.json().catch(()=>({}));throw Error(e.detail||e.message||`API Error: ${c.status}`)}return c.json()},changeRequestStatus:async(e,t,s,a)=>c(`/requests/${e}/change_status/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_status:t,note:s||"",...void 0!==a?{remarks:a}:{}})}),async listTeamRequests(e,t){let s=new URLSearchParams;return t?.category&&s.append("category",t.category),t?.status&&s.append("status",t.status),t?.fab_type&&s.append("fab_type",t.fab_type),t?.search&&s.append("search",t.search),t?.ordering&&s.append("ordering",t.ordering),t?.page&&s.append("page",t.page.toString()),t?.page_size&&s.append("page_size",t.page_size.toString()),c(`/teams/${e}/requests/${s.toString()?`?${s.toString()}`:""}`)}}],88771)},88886,e=>{"use strict";var t=e.i(1972),s=e.i(75305);let a=["Submitted","Processing","Issued"];function r({status:e}){return(0,t.jsx)("div",{className:"flex items-center gap-2","aria-label":"Request status progress",children:a.map((r,i)=>{let n=a.indexOf(e),d=n>=i;return(0,t.jsxs)(s.default.Fragment,{children:[(0,t.jsxs)("div",{className:`flex flex-col items-center text-[10px] font-medium ${d?"text-[#002449]":"text-gray-400"}`,children:[(0,t.jsx)("div",{className:`h-2.5 w-2.5 rounded-full ${d?n===i?"bg-[#f75700]":"bg-[#002449]":"bg-gray-300"}`}),(0,t.jsx)("span",{className:"mt-1 tracking-wide",children:r})]}),i<a.length-1&&(0,t.jsx)("div",{className:`h-px w-6 ${n>i?"bg-[#002449]":"bg-gray-300"}`,"aria-hidden":"true"})]},r)})})}e.s(["RequestProgress",()=>r])},51021,e=>{"use strict";var t=e.i(1972),s=e.i(75305);function a({open:e,currentStatus:a,targetStatus:r,onClose:i,onConfirm:n,loading:d=!1}){let[l,c]=(0,s.useState)("");(0,s.useEffect)(()=>{e&&c("")},[e,a,r]);let o=(0,s.useMemo)(()=>"Cannot be Processed"===r||"Processing"===a&&"Issued"===r,[a,r]);return e?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,t.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-white p-6 shadow-xl animate-in fade-in slide-in-from-bottom",children:[(0,t.jsx)("h2",{className:"mb-4 text-lg font-semibold",style:{color:"#002449"},children:"Confirm Status Update"}),(0,t.jsxs)("div",{className:"mb-4 space-y-2 text-sm",children:[(0,t.jsxs)("p",{className:"text-gray-600",children:["You are changing the request from ",(0,t.jsx)("span",{className:"font-semibold",children:a})," to "," ",(0,t.jsx)("span",{className:"font-semibold",children:r}),"."]}),(0,t.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-gray-500",children:o?"A remark for the team is required before you continue.":"Review the update and confirm when ready."})]}),o&&(0,t.jsxs)("div",{className:"mb-5 space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-600",children:"Remarks for Team (required)"}),(0,t.jsx)("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:"Share any guidance or context for the team.",className:"w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#f75700]/40",rows:3}),(0,t.jsx)("p",{className:"text-[11px] text-gray-500",children:"These remarks are visible to the team on their dashboard and request view."})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:i,disabled:d,className:"flex-1 rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 transition hover:bg-gray-50 disabled:cursor-not-allowed",children:"Cancel"}),(0,t.jsx)("button",{type:"button",onClick:()=>n(l.trim()||void 0),disabled:d,className:"flex-1 rounded-lg bg-[#f75700] px-4 py-2 text-sm font-semibold text-white transition hover:bg-[#f75700]/90 disabled:cursor-not-allowed disabled:opacity-60",children:d?"Updating...":"Confirm"})]})]})}):null}e.s(["StatusChangeModal",()=>a])},22529,e=>{"use strict";var t=e.i(1972),s=e.i(75305),a=e.i(30499),r=e.i(14077),i=e.i(88771),n=e.i(51021),d=e.i(88886);function l(){var e;let l=(0,a.useRouter)(),x=(0,a.useParams)().id,[p,u]=(0,s.useState)(null),[h,g]=(0,s.useState)(!0),[f,y]=(0,s.useState)(""),[b,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)(null),v=r.authService.getCurrentUser();(0,s.useEffect)(()=>{if(!r.authService.getAccessToken())return void l.push("/login")},[l]),(0,s.useEffect)(()=>{(async()=>{try{g(!0);let e=await i.requestsService.getRequest(Number.parseInt(x));u(e)}catch(e){console.error("[v0] Error fetching request:",e),y(e instanceof Error?e.message:"Failed to load request")}finally{g(!1)}})()},[x]);let S=(0,s.useCallback)((e,t)=>"Cannot be Processed"===t||"Processing"===e&&"Issued"===t,[]),_=(0,s.useCallback)(async(e,t)=>{if(p)try{j(!0);let s=await i.requestsService.changeRequestStatus(p.id,e,`Status changed to ${e}`,t);u(s),N(null)}catch(e){y(e instanceof Error?e.message:"Failed to update status")}finally{j(!1)}},[p]),q=(0,s.useCallback)(e=>{if(p){if(S(p.status,e))return void N(e);_(e)}},[_,p,S]);if(h)return(0,t.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"mx-auto mb-4 h-10 w-10 animate-spin rounded-full border-4 border-gray-300 border-t-[#f75700]"}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading request..."})]})});if(!p)return(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:f||"Request not found"})});let k=v?.is_poc||v?.is_admin,R="Submitted"===p.status?["Processing","Cannot be Processed"]:"Processing"===p.status?["Issued","Cannot be Processed"]:[],C=c(p.status),$=`${C}1a`,T=`linear-gradient(135deg, ${$} 0%, #ffffff 65%)`,P=p.notes.trim().length>0?p.notes:p.description&&p.description.trim().length>0?p.description:"Request",U=p.description&&p.description.trim().length>0?p.description:p.notes.trim().length>0?p.notes:"No additional details were provided.",I=new Date(p.created_at).toLocaleString(),E=new Date(p.updated_at).toLocaleString(),A=p.position?`#${p.position}`:"--",O=p.team_name||"Unassigned Team";return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mx-auto max-w-6xl space-y-8 pb-12",children:[f&&(0,t.jsx)("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-4 shadow-sm",children:(0,t.jsx)("p",{className:"text-sm text-red-800",children:f})}),(0,t.jsxs)("section",{className:"relative overflow-hidden rounded-3xl border border-gray-200 bg-white shadow-xl",children:[(0,t.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:T}}),(0,t.jsxs)("div",{className:"relative space-y-6 p-8 md:p-12",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,t.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold text-white",style:{backgroundColor:"BOM"===(e=p.category)?"#002449":"ADDITIONAL"===e?"#007367":"#f75700"},children:p.category}),(0,t.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold text-white",style:{backgroundColor:c(p.status)},children:p.status})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 md:text-4xl",children:P}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs font-semibold text-gray-600",children:[(0,t.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 shadow-sm",children:[(0,t.jsx)("span",{className:"uppercase tracking-wide text-gray-500",children:"Request"}),(0,t.jsxs)("span",{className:"text-gray-900",children:["#",p.id]})]}),(0,t.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 shadow-sm",children:[(0,t.jsx)("span",{className:"uppercase tracking-wide text-gray-500",children:"Team"}),(0,t.jsx)("span",{className:"text-gray-900",children:O})]}),(0,t.jsxs)("span",{className:"inline-flex items-center gap-2 rounded-full bg-white/70 px-3 py-1 shadow-sm",children:[(0,t.jsx)("span",{className:"uppercase tracking-wide text-gray-500",children:"Queue"}),(0,t.jsx)("span",{className:"text-gray-900",children:A})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4 rounded-2xl border border-white/60 bg-white/70 px-4 py-3 shadow-inner",children:[(0,t.jsx)("span",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Progress"}),(0,t.jsx)(d.RequestProgress,{status:p.status})]}),(0,t.jsxs)("div",{className:"grid gap-4 text-xs font-semibold text-gray-700 sm:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(o,{label:"Created",value:I}),(0,t.jsx)(o,{label:"Updated",value:E}),(0,t.jsx)(o,{label:"Category",value:p.category}),(0,t.jsx)(o,{label:"Status",value:p.status})]})]})]}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(m,{title:"Overview",children:(0,t.jsx)("p",{className:"whitespace-pre-line text-sm leading-relaxed text-gray-700",children:U})}),p.remarks&&(0,t.jsx)(m,{title:"Team Remarks",children:(0,t.jsxs)("div",{className:"rounded-xl border border-orange-200 bg-orange-50 px-4 py-4 text-sm text-gray-800 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-[#f75700]",children:"Latest Remark"}),(0,t.jsx)("p",{className:"mt-2 whitespace-pre-line leading-relaxed",children:p.remarks})]})}),p.bom_items&&p.bom_items.length>0&&(0,t.jsx)(m,{title:"BOM Items",children:(0,t.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Item Name"}),(0,t.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Qty"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-100 bg-white",children:p.bom_items.map((e,s)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-4 py-2 text-sm font-medium text-gray-800",children:e.item_name}),(0,t.jsx)("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:e.quantity})]},s))})]})})}),p.additional_items&&p.additional_items.length>0&&(0,t.jsx)(m,{title:"Additional Items",children:(0,t.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-100",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-100 text-sm",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Item Name"}),(0,t.jsx)("th",{className:"px-4 py-2 text-right text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Qty"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-100 bg-white",children:p.additional_items.map((e,s)=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-4 py-2 text-sm font-medium text-gray-800",children:e.item_name}),(0,t.jsx)("td",{className:"px-4 py-2 text-right font-semibold text-gray-900",children:e.quantity})]},s))})]})})}),p.fabrication&&(0,t.jsxs)(m,{title:"Fabrication Details",children:[(0,t.jsxs)("div",{className:"grid gap-3 text-sm sm:grid-cols-2",children:[(0,t.jsx)(o,{label:"Type",value:p.fabrication.fab_type}),(0,t.jsx)(o,{label:"Name",value:p.fabrication.name})]}),p.fabrication.file&&(0,t.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-gray-500",children:"Attachment"}),(0,t.jsx)("a",{href:p.fabrication.file,target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-flex items-center gap-2 rounded-lg border border-[#002449]/20 bg-[#002449]/5 px-3 py-2 text-sm font-semibold text-[#002449] transition hover:bg-[#002449]/10",children:"Download fabrication file"})]})]})]}),(0,t.jsxs)("aside",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-[#002449]",children:"Key Details"}),(0,t.jsxs)("dl",{className:"mt-4 space-y-3 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Request ID"}),(0,t.jsxs)("dd",{className:"text-sm font-semibold text-gray-900",children:["#",p.id]})]}),(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Team"}),(0,t.jsx)("dd",{className:"max-w-[12rem] text-right text-sm font-semibold text-gray-900",children:O})]}),(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Queue Position"}),(0,t.jsx)("dd",{className:"text-sm font-semibold text-gray-900",children:A})]}),(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Created"}),(0,t.jsx)("dd",{className:"max-w-[12rem] text-right text-sm font-semibold text-gray-900",children:I})]}),(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("dt",{className:"text-xs font-medium uppercase tracking-wide text-gray-500",children:"Updated"}),(0,t.jsx)("dd",{className:"max-w-[12rem] text-right text-sm font-semibold text-gray-900",children:E})]})]})]}),k&&R.length>0&&(0,t.jsxs)("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold text-[#f75700]",children:"Update Status"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Choose the next stage for this request. You can add remarks to guide the team before confirming."}),(0,t.jsx)("div",{className:"mt-4 flex flex-wrap gap-2",children:R.map(e=>(0,t.jsx)("button",{onClick:()=>q(e),disabled:b,className:"rounded-lg px-4 py-2 text-xs font-semibold text-white shadow-sm transition disabled:cursor-not-allowed disabled:opacity-70",style:{backgroundColor:"Cannot be Processed"===e?"#f75700":"#078e31"},children:b?"Updating...":"Cannot be Processed"===e?"Reject":`Mark ${e}`},e))})]})]})]})]}),p&&w&&(0,t.jsx)(n.StatusChangeModal,{open:!!w,currentStatus:p.status,targetStatus:w,loading:b,onClose:()=>N(null),onConfirm:async e=>{await _(w,e)}})]})}function c(e){return"Submitted"===e?"#f75700":"Processing"===e?"#002449":"Issued"===e?"#078e31":"#6b7280"}function o({label:e,value:s}){return(0,t.jsxs)("div",{className:"rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm",children:[(0,t.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:e}),(0,t.jsx)("p",{className:"mt-2 text-sm font-semibold text-gray-900 break-words",children:s})]})}function m({title:e,children:s}){return(0,t.jsxs)("section",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-base font-semibold text-[#002449]",children:e}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:s})]})}e.s(["default",()=>l])}]);