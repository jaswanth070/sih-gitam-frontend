(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,88771,e=>{"use strict";var t=e.i(14077);let s="http://127.0.0.1:8001/api";async function a(e,r={}){let i=`${s}${e}`,n=new Headers(r.headers||{}),d=t.authService.getAccessToken();d&&!n.has("Authorization")&&n.set("Authorization",`Bearer ${d}`);let l=await fetch(i,{...r,headers:n});if(401===l.status){let e=t.authService.getRefreshToken();if(e)try{let t=await fetch(`${s}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:e})});if(t.ok){let{access:e}=await t.json();localStorage.setItem("sih_access_token",e),n.set("Authorization",`Bearer ${e}`),l=await fetch(i,{...r,headers:n})}}catch(e){t.authService.clearTokens(),window.location.href="/login"}}if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.detail||e.message||`API Error: ${l.status}`)}return l.json()}e.s(["requestsService",0,{async listRequests(e){let t=new URLSearchParams;return e?.category&&t.append("category",e.category),e?.status&&t.append("status",e.status),e?.fab_type&&t.append("fab_type",e.fab_type),e?.team_id&&t.append("team_id",e.team_id),e?.search&&t.append("search",e.search),e?.ordering&&t.append("ordering",e.ordering),e?.page&&t.append("page",e.page.toString()),a(`/requests/?${t.toString()}`)},getQueueSnapshot:async(e=!0)=>a(`/requests/queue/?include_positions=${e}`),async getFilteredQueueSnapshot(e){let t=new URLSearchParams;return e.category&&t.append("category",e.category),e.status&&t.append("status",e.status),e.fab_type&&t.append("fab_type",e.fab_type),void 0!==e.include_positions&&t.append("include_positions",e.include_positions?"true":"false"),e.page&&t.append("page",e.page.toString()),e.page_size&&t.append("page_size",e.page_size.toString()),a(`/requests/queue/?${t.toString()}`)},getRequest:async e=>a(`/requests/${e}/`),createBOMRequest:async(e,t,s)=>a("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:e,category:"BOM",notes:t,bom_items:s})}),createAdditionalRequest:async(e,t,s)=>a("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:e,category:"ADDITIONAL",notes:t,additional_items:s})}),async createFabricationRequest(e,a,r,i){let n=new FormData;n.append("team_id",e),n.append("category","FABRICATION"),n.append("notes",a),n.append("fabrication",JSON.stringify(r)),i&&n.append("file",i);let d=t.authService.getAccessToken(),l=new Headers;d&&l.set("Authorization",`Bearer ${d}`);let o=await fetch(`${s}/requests/`,{method:"POST",headers:l,body:n});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(e.detail||e.message||`API Error: ${o.status}`)}return o.json()},changeRequestStatus:async(e,t,s)=>a(`/requests/${e}/change_status/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_status:t,note:s||""})}),async listTeamRequests(e,t){let s=new URLSearchParams;return t?.category&&s.append("category",t.category),t?.status&&s.append("status",t.status),t?.fab_type&&s.append("fab_type",t.fab_type),t?.search&&s.append("search",t.search),t?.ordering&&s.append("ordering",t.ordering),t?.page&&s.append("page",t.page.toString()),t?.page_size&&s.append("page_size",t.page_size.toString()),a(`/teams/${e}/requests/${s.toString()?`?${s.toString()}`:""}`)}}])},88886,e=>{"use strict";var t=e.i(43476),s=e.i(71645);let a=["Submitted","Processing","Issued"];function r({status:e}){return(0,t.jsx)("div",{className:"flex items-center gap-2","aria-label":"Request status progress",children:a.map((r,i)=>{let n=a.indexOf(e),d=n>=i;return(0,t.jsxs)(s.default.Fragment,{children:[(0,t.jsxs)("div",{className:`flex flex-col items-center text-[10px] font-medium ${d?"text-[#002449]":"text-gray-400"}`,children:[(0,t.jsx)("div",{className:`h-2.5 w-2.5 rounded-full ${d?n===i?"bg-[#f75700]":"bg-[#002449]":"bg-gray-300"}`}),(0,t.jsx)("span",{className:"mt-1 tracking-wide",children:r})]}),i<a.length-1&&(0,t.jsx)("div",{className:`h-px w-6 ${n>i?"bg-[#002449]":"bg-gray-300"}`,"aria-hidden":"true"})]},r)})})}e.s(["RequestProgress",()=>r])},22529,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),r=e.i(14077),i=e.i(88771),n=e.i(88886);function d(){var e;let d=(0,a.useRouter)(),p=(0,a.useParams)().id,[u,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(!0),[x,b]=(0,s.useState)(""),[f,y]=(0,s.useState)(!1),j=r.authService.getCurrentUser();(0,s.useEffect)(()=>{if(!r.authService.getAccessToken())return void d.push("/login")},[d]),(0,s.useEffect)(()=>{(async()=>{try{h(!0);let e=await i.requestsService.getRequest(Number.parseInt(p));m(e)}catch(e){console.error("[v0] Error fetching request:",e),b(e instanceof Error?e.message:"Failed to load request")}finally{h(!1)}})()},[p]);let N=async e=>{if(u)try{y(!0);let t=await i.requestsService.changeRequestStatus(u.id,e);m(t)}catch(e){b(e instanceof Error?e.message:"Failed to update status")}finally{y(!1)}};if(g)return(0,t.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-10 h-10 border-4 border-gray-300 border-t-[#f75700] rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading request..."})]})});if(!u)return(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("p",{className:"text-gray-600 text-sm",children:x||"Request not found"})});let v=j?.is_poc||j?.is_admin,w="Submitted"===u.status?["Processing","Cannot be Processed"]:"Processing"===u.status?["Issued","Cannot be Processed"]:[];return(0,t.jsxs)("div",{className:"max-w-5xl mx-auto",children:[x&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,t.jsx)("p",{className:"text-red-800 text-sm",children:x})}),(0,t.jsxs)("div",{className:"group relative bg-white border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm",style:{boxShadow:`inset 0 0 0 2px ${l(u.status)}20`},children:[(0,t.jsx)("span",{className:"absolute inset-y-0 left-0 w-1 rounded-l-xl",style:{backgroundColor:l(u.status)}}),(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row items-start justify-between gap-6 lg:gap-10 mb-6",children:[(0,t.jsxs)("div",{className:"space-y-3 md:space-y-4 flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,t.jsx)("span",{className:"px-3 py-1 text-xs font-semibold text-white rounded-md",style:{backgroundColor:"BOM"===(e=u.category)?"#002449":"ADDITIONAL"===e?"#007367":"#f75700"},children:u.category}),(0,t.jsx)(n.RequestProgress,{status:u.status})]}),(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 tracking-tight line-clamp-3",children:u.notes||"Request"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-[11px] md:text-xs w-full lg:w-auto lg:min-w-[24rem]",children:[(0,t.jsx)(o,{label:"Created",value:new Date(u.created_at).toLocaleString()}),(0,t.jsx)(o,{label:"Updated",value:new Date(u.updated_at).toLocaleString()}),(0,t.jsx)(o,{label:"Status",value:u.status}),u.position&&(0,t.jsx)(o,{label:"Queue",value:"#"+u.position})]})]}),u.bom_items&&u.bom_items.length>0&&(0,t.jsx)(c,{title:"BOM Items",children:(0,t.jsxs)("table",{className:"w-full text-sm table-fixed",children:[(0,t.jsx)("thead",{className:"bg-gray-50 border border-gray-200",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-3 py-2 text-left font-semibold",children:"Item Name"}),(0,t.jsx)("th",{className:"px-3 py-2 text-right font-semibold",children:"Qty"})]})}),(0,t.jsx)("tbody",{children:u.bom_items.map((e,s)=>(0,t.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:e.item_name}),(0,t.jsx)("td",{className:"px-3 py-2 text-right font-semibold",children:e.quantity})]},s))})]})}),u.additional_items&&u.additional_items.length>0&&(0,t.jsx)(c,{title:"Additional Items",children:(0,t.jsxs)("table",{className:"w-full text-sm table-fixed",children:[(0,t.jsx)("thead",{className:"bg-gray-50 border border-gray-200",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-3 py-2 text-left font-semibold",children:"Item Name"}),(0,t.jsx)("th",{className:"px-3 py-2 text-right font-semibold",children:"Qty"})]})}),(0,t.jsx)("tbody",{children:u.additional_items.map((e,s)=>(0,t.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-3 py-2",children:e.item_name}),(0,t.jsx)("td",{className:"px-3 py-2 text-right font-semibold",children:e.quantity})]},s))})]})}),u.fabrication&&(0,t.jsxs)(c,{title:"Fabrication Details",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,t.jsx)(o,{label:"Type",value:u.fabrication.fab_type}),(0,t.jsx)(o,{label:"Name",value:u.fabrication.name})]}),u.fabrication.file&&(0,t.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,t.jsx)("a",{href:u.fabrication.file,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1.5 rounded-md border border-gray-300 text-xs font-medium text-[#002449] hover:bg-gray-50",children:"Download File â†’"})})]}),v&&w.length>0&&(0,t.jsxs)("div",{className:"pt-6 mt-6 border-t border-gray-200",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold mb-4",style:{color:"#f75700"},children:"Update Status"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(e=>(0,t.jsx)("button",{onClick:()=>N(e),disabled:f,className:"px-4 py-2 text-xs font-semibold rounded-md text-white",style:{backgroundColor:"Cannot be Processed"===e?"#f75700":"#078e31"},children:f?"Updating...":"Cannot be Processed"===e?"Reject":"Mark "+e},e))})]})]})]})}function l(e){return"Submitted"===e?"#f75700":"Processing"===e?"#002449":"Issued"===e?"#078e31":"#6b7280"}function o({label:e,value:s}){return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-[10px] uppercase tracking-wide text-gray-500 font-medium",children:e}),(0,t.jsx)("p",{className:"text-xs font-semibold text-gray-900 truncate whitespace-nowrap max-w-[12rem]",title:s,children:s})]})}function c({title:e,children:s}){return(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h2",{className:"text-sm font-semibold mb-3",style:{color:"#002449"},children:e}),(0,t.jsx)("div",{className:"rounded-lg border border-gray-200 bg-white overflow-hidden p-2 md:p-3",children:s})]})}e.s(["default",()=>d])}]);