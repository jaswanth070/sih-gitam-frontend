module.exports=[38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},11634,a=>{"use strict";let b=new class{accessTokenKey="sih_access_token";refreshTokenKey="sih_refresh_token";setTokens(a,b){}getAccessToken(){return null}getRefreshToken(){return null}clearTokens(){}async request(a,b={},c=0){let d=`http://127.0.0.1:8000/api${a}`,e=new Headers(b.headers||{}),f=this.getAccessToken();f&&e.set("Authorization",`Bearer ${f}`);let g=await fetch(d,{...b,headers:e});if(401===g.status&&0===c){let c=this.getRefreshToken();if(c)try{return await this.refreshAccessToken(c),this.request(a,b,1)}catch(a){throw this.clearTokens(),Error("Session expired. Please login again.")}}if(!g.ok){let a=await g.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${g.status}`)}return g.json()}getCurrentUser(){return null}base64UrlDecode(a){let b=a.replace(/-/g,"+").replace(/_/g,"/"),c=b.length%4;return c&&(b+="=".repeat(4-c)),Buffer.from(b,"base64").toString("utf-8")}async login(a){let b=await this.request("/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return this.setTokens(b.access,b.refresh),b}async refreshAccessToken(a){let b=(await this.request("/token/refresh/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:a})})).access;return localStorage.setItem(this.accessTokenKey,b),b}async requestOTP(a){return this.request("/auth/send-otp/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,purpose:"first_login"})})}async verifyOTPAndSetPassword(a){return this.request("/auth/verify-otp/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}async autoLogin(a,b){return this.login({email:a,password:b})}async getTeamDetails(a=!1){return this.request(a?"/leader/team/?preview=1":"/leader/team/")}async confirmTeamDetails(){return this.request("/leader/team/confirm/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})}async getPOCTeams(){return this.request("/poc/teams/")}async getPOCTeamDetail(a){return this.request(`/poc/teams/${a}/`)}async logout(){let a=this.getRefreshToken();if(!a)return this.clearTokens(),{detail:"Logged out"};try{let b=await this.request("/auth/logout/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:a})});return this.clearTokens(),b}catch(a){return this.clearTokens(),{detail:"Logged out"}}}async logoutAll(){try{let a=await this.request("/auth/logout_all/",{method:"POST",headers:{"Content-Type":"application/json"}});return this.clearTokens(),a}catch(a){return this.clearTokens(),{detail:"Logged out from all devices"}}}};a.s(["authService",0,b])},84120,a=>{"use strict";var b=a.i(11634);let c="http://127.0.0.1:8001/api";async function d(a,e={}){let f=`${c}${a}`,g=new Headers(e.headers||{}),h=b.authService.getAccessToken();h&&!g.has("Authorization")&&g.set("Authorization",`Bearer ${h}`);let i=await fetch(f,{...e,headers:g});if(401===i.status){let a=b.authService.getRefreshToken();if(a)try{let b=await fetch(`${c}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:a})});if(b.ok){let{access:a}=await b.json();localStorage.setItem("sih_access_token",a),g.set("Authorization",`Bearer ${a}`),i=await fetch(f,{...e,headers:g})}}catch(a){b.authService.clearTokens(),window.location.href="/login"}}if(!i.ok){let a=await i.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${i.status}`)}return i.json()}a.s(["requestsService",0,{async listRequests(a){let b=new URLSearchParams;return a?.category&&b.append("category",a.category),a?.status&&b.append("status",a.status),a?.fab_type&&b.append("fab_type",a.fab_type),a?.team_id&&b.append("team_id",a.team_id),a?.search&&b.append("search",a.search),a?.ordering&&b.append("ordering",a.ordering),a?.page&&b.append("page",a.page.toString()),d(`/requests/?${b.toString()}`)},getQueueSnapshot:async(a=!0)=>d(`/requests/queue/?include_positions=${a}`),async getFilteredQueueSnapshot(a){let b=new URLSearchParams;return a.category&&b.append("category",a.category),a.status&&b.append("status",a.status),a.fab_type&&b.append("fab_type",a.fab_type),void 0!==a.include_positions&&b.append("include_positions",a.include_positions?"true":"false"),a.page&&b.append("page",a.page.toString()),a.page_size&&b.append("page_size",a.page_size.toString()),d(`/requests/queue/?${b.toString()}`)},getRequest:async a=>d(`/requests/${a}/`),createBOMRequest:async(a,b,c)=>d("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,category:"BOM",notes:b,bom_items:c})}),createAdditionalRequest:async(a,b,c)=>d("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,category:"ADDITIONAL",notes:b,additional_items:c})}),async createFabricationRequest(a,d,e,f){let g=new FormData;g.append("team_id",a),g.append("category","FABRICATION"),g.append("notes",d),g.append("fabrication",JSON.stringify(e)),f&&g.append("file",f);let h=b.authService.getAccessToken(),i=new Headers;h&&i.set("Authorization",`Bearer ${h}`);let j=await fetch(`${c}/requests/`,{method:"POST",headers:i,body:g});if(!j.ok){let a=await j.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${j.status}`)}return j.json()},changeRequestStatus:async(a,b,c)=>d(`/requests/${a}/change_status/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_status:b,note:c||""})}),async listTeamRequests(a,b){let c=new URLSearchParams;return b?.category&&c.append("category",b.category),b?.status&&c.append("status",b.status),b?.fab_type&&c.append("fab_type",b.fab_type),b?.search&&c.append("search",b.search),b?.ordering&&c.append("ordering",b.ordering),b?.page&&c.append("page",b.page.toString()),b?.page_size&&c.append("page_size",b.page_size.toString()),d(`/teams/${a}/requests/${c.toString()?`?${c.toString()}`:""}`)}}])},93107,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=["Submitted","Processing","Issued"];function e({status:a}){return(0,b.jsx)("div",{className:"flex items-center gap-2","aria-label":"Request status progress",children:d.map((e,f)=>{let g=d.indexOf(a),h=g>=f;return(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsxs)("div",{className:`flex flex-col items-center text-[10px] font-medium ${h?"text-[#002449]":"text-gray-400"}`,children:[(0,b.jsx)("div",{className:`h-2.5 w-2.5 rounded-full ${h?g===f?"bg-[#f75700]":"bg-[#002449]":"bg-gray-300"}`}),(0,b.jsx)("span",{className:"mt-1 tracking-wide",children:e})]}),f<d.length-1&&(0,b.jsx)("div",{className:`h-px w-6 ${g>f?"bg-[#002449]":"bg-gray-300"}`,"aria-hidden":"true"})]},e)})})}a.s(["RequestProgress",()=>e])},45083,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(11634),g=a.i(84120),h=a.i(90599),i=a.i(93107);function j(){var a;let e,i,j,l,m,n;(0,d.useRouter)();let o=(0,d.useParams)().id,[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)(!0),[v,w]=(0,c.useState)("");(0,c.useEffect)(()=>{let a=async()=>{try{let a=await f.authService.getPOCTeamDetail(o);q(a)}catch(a){w(a.message||"Failed to load team details")}finally{u(!1)}};o&&a()},[o]),a=a=>{s(b=>{if(("request_created"===a.event||"request_updated"===a.event)&&a.request){let c=a.request;return c.team_id!==o?b:[...b.filter(a=>a.id!==c.id),c].sort((a,b)=>new Date(a.created_at).getTime()-new Date(b.created_at).getTime())}return"state_transition"===a.event&&a.request_id?b.map(b=>b.id===a.request_id?{...b,status:a.to}:b).sort((a,b)=>new Date(a.created_at).getTime()-new Date(b.created_at).getTime()):b})},e=(0,c.useRef)(null),i=(0,c.useRef)(1e3),j=(0,c.useRef)(!1),l=(0,c.useRef)(void 0),m=(0,c.useCallback)(()=>{let a=f.authService.getAccessToken();if(!a)return null;let b=function(){try{return new URL("http://127.0.0.1:8001/api").origin}catch(a){}return"http://127.0.0.1:8001"}();if(!b)return null;let c=b.startsWith("https://"),d=b.replace(/^https?:\/\//,"");return`${c?"wss":"ws"}://${d}/ws/requests/?token=${a}`},[]),n=(0,c.useCallback)(()=>{let b=m();if(b)try{let c=new WebSocket(b);e.current=c,c.onopen=()=>{console.log("[v0] WebSocket connected"),i.current=1e3},c.onmessage=b=>{try{let c=JSON.parse(b.data);a(c)}catch(a){console.error("[v0] Failed to parse WS message:",a)}},c.onclose=a=>{console.log("[v0] WebSocket closed",a.code,a.reason||""),j.current||(l.current=setTimeout(()=>{console.log("[v0] Attempting to reconnect with backoff:",i.current),n(),i.current=Math.min(2*i.current,3e4)},i.current))},c.onerror=a=>{console.error("[v0] WebSocket error: network/connection issue",{type:a.type})}}catch(a){console.error("[v0] Failed to create WebSocket:",a)}},[m,a]),(0,c.useEffect)(()=>(j.current=!1,n(),()=>{j.current=!0,l.current&&clearTimeout(l.current),e.current&&e.current.close()}),[n]),e.current?.readyState,WebSocket.OPEN,(0,c.useEffect)(()=>{if(!o)return;let a=async()=>{try{let a=[...(await g.requestsService.listTeamRequests(o,{ordering:"created_at",page_size:100})).results].sort((a,b)=>new Date(a.created_at).getTime()-new Date(b.created_at).getTime());s(a)}catch(a){console.error("[team] Error fetching team requests snapshot:",a)}};a();let b=setInterval(a,3e5);return()=>clearInterval(b)},[o]);let x=async(a,b)=>{try{let c=await g.requestsService.changeRequestStatus(a,b);setBOMRequests(a=>a.map(a=>a.id===c.id?c:a))}catch(a){w(a instanceof Error?a.message:"Failed to update status")}};return(0,b.jsx)(h.DashboardShell,{children:(0,b.jsxs)("div",{className:"space-y-8",children:[v&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,b.jsx)("p",{className:"text-red-800 text-sm",children:v})}),t?(0,b.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-10 h-10 border-4 border-gray-300 border-t-[#f75700] rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading team details..."})]})}):p?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2 min-w-0",children:[(0,b.jsx)("h1",{className:"text-xl md:text-2xl font-bold",style:{color:"#002449"},children:p.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600 truncate",children:p.institution}),p.problem_statement&&(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-[10px] font-semibold tracking-wide bg-[#002449]/10 text-[#002449] border border-[#002449]/20 w-fit",children:["PS ID: ",p.problem_statement.id]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4 w-full md:w-auto",children:[p.faculty_mentor&&(0,b.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-medium",children:"Mentor"}),(0,b.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:p.faculty_mentor.name})]}),p.poc&&(0,b.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-medium",children:"POC"}),(0,b.jsx)("p",{className:"text-sm font-semibold text-gray-900 mt-1",children:p.poc?.name||"N/A"})]})]})]}),p.members?.length>0&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-gray-500 font-medium",children:"Team Members"}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3",children:p.members.map(a=>(0,b.jsxs)("div",{className:"border border-gray-200 bg-gray-50 rounded-md p-3 flex flex-col gap-0.5",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.user.name||a.user.email}),(0,b.jsx)("p",{className:"text-[11px] text-gray-600",children:a.role.replace(/_/g," ")})]},a.user.email))})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold",style:{color:"#002449"},children:["Team Requests (",r.length,")"]}),0===r.length?(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"No requests yet."}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(a=>(0,b.jsx)(k,{request:a,onStatusChange:x},a.id))})]})]}):(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"No team data found."})]})})}function k({request:a,onStatusChange:c}){let d="Submitted"===a.status?"#f75700":"Processing"===a.status?"#002449":"Issued"===a.status?"#078e31":"#6b7280",f="Submitted"===a.status?["Processing","Cannot be Processed"]:"Processing"===a.status?["Issued","Cannot be Processed"]:[];return(0,b.jsxs)("div",{className:"group relative bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition flex flex-col",style:{boxShadow:`inset 0 0 0 2px ${d}20`},children:[(0,b.jsx)("span",{className:"absolute inset-y-0 left-0 w-1 rounded-l-lg",style:{backgroundColor:d}}),(0,b.jsxs)("div",{className:"flex items-center justify-between gap-3 mb-2",children:[(0,b.jsx)("span",{className:"px-2 py-0.5 text-[10px] font-semibold text-white rounded-md",style:{backgroundColor:"BOM"===a.category?"#002449":"ADDITIONAL"===a.category?"#007367":"#f75700"},children:a.category}),(0,b.jsx)(i.RequestProgress,{status:a.status})]}),(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-900 line-clamp-2 mb-2",children:a.notes||"Untitled"}),a.fabrication&&(0,b.jsxs)("p",{className:"text-xs text-gray-600 mb-2",children:[a.fabrication.fab_type," â€¢ ",a.fabrication.name]}),(a.bom_items?.length||0)>0&&(0,b.jsx)("div",{className:"mb-2 space-y-1 max-h-20 overflow-auto pr-0.5",children:a.bom_items.map(a=>(0,b.jsxs)("div",{className:"px-2 py-0.5 text-[10px] rounded bg-gray-100 text-gray-700 border border-gray-200 flex justify-between",children:[(0,b.jsx)("span",{className:"truncate pr-2",children:a.item_name}),(0,b.jsxs)("span",{className:"font-mono",children:["x",a.quantity]})]},a.id||a.item_name))}),(a.additional_items?.length||0)>0&&(0,b.jsx)("div",{className:"mb-2 space-y-1 max-h-20 overflow-auto pr-0.5",children:a.additional_items.map(a=>(0,b.jsxs)("div",{className:"px-2 py-0.5 text-[10px] rounded bg-gray-100 text-gray-700 border border-gray-200 flex justify-between",children:[(0,b.jsx)("span",{className:"truncate pr-2",children:a.item_name}),(0,b.jsxs)("span",{className:"font-mono",children:["x",a.quantity]})]},a.id||a.item_name))}),(0,b.jsxs)("div",{className:"mt-auto pt-2 grid grid-cols-2 gap-2 text-[10px] text-gray-600",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"font-medium text-gray-500",children:"Submitted"}),(0,b.jsx)("time",{title:a.created_at,children:new Date(a.created_at).toLocaleString()})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end",children:[(0,b.jsx)("span",{className:"font-medium text-gray-500",children:"Updated"}),(0,b.jsx)("time",{title:a.updated_at,children:new Date(a.updated_at).toLocaleString()})]})]}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap gap-2",children:[(0,b.jsx)(e.default,{href:`/requests/${a.id}`,className:"px-3 py-1.5 text-[11px] font-medium rounded-md border border-gray-300 hover:bg-gray-50",children:"View"}),f.map(d=>(0,b.jsx)("button",{onClick:()=>c(a.id,d),className:"px-3 py-1.5 text-[11px] font-medium rounded-md text-white",style:{backgroundColor:"Cannot be Processed"===d?"#f75700":"#078e31"},children:"Cannot be Processed"===d?"Reject":"Processing"===d?"Accept":"Issued"===d?"Issue":d},d))]})]})}a.s(["default",()=>j],45083)}];

//# sourceMappingURL=_74c6678c._.js.map