module.exports=[84120,a=>{"use strict";var b=a.i(11634);let c="http://127.0.0.1:8001/api";async function d(a,e={}){let f=`${c}${a}`,g=new Headers(e.headers||{}),h=b.authService.getAccessToken();h&&!g.has("Authorization")&&g.set("Authorization",`Bearer ${h}`);let i=await fetch(f,{...e,headers:g});if(401===i.status){let a=b.authService.getRefreshToken();if(a)try{let b=await fetch(`${c}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:a})});if(b.ok){let{access:a}=await b.json();localStorage.setItem("sih_access_token",a),g.set("Authorization",`Bearer ${a}`),i=await fetch(f,{...e,headers:g})}}catch(a){b.authService.clearTokens(),window.location.href="/login"}}if(!i.ok){let a=await i.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${i.status}`)}return i.json()}a.s(["requestsService",0,{async listRequests(a){let b=new URLSearchParams;return a?.category&&b.append("category",a.category),a?.status&&b.append("status",a.status),a?.fab_type&&b.append("fab_type",a.fab_type),a?.team_id&&b.append("team_id",a.team_id),a?.search&&b.append("search",a.search),a?.ordering&&b.append("ordering",a.ordering),a?.page&&b.append("page",a.page.toString()),d(`/requests/?${b.toString()}`)},getQueueSnapshot:async(a=!0)=>d(`/requests/queue/?include_positions=${a}`),async getFilteredQueueSnapshot(a){let b=new URLSearchParams;return a.category&&b.append("category",a.category),a.status&&b.append("status",a.status),a.fab_type&&b.append("fab_type",a.fab_type),void 0!==a.include_positions&&b.append("include_positions",a.include_positions?"true":"false"),a.page&&b.append("page",a.page.toString()),a.page_size&&b.append("page_size",a.page_size.toString()),d(`/requests/queue/?${b.toString()}`)},getRequest:async a=>d(`/requests/${a}/`),createBOMRequest:async(a,b,c)=>d("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,category:"BOM",notes:b,bom_items:c})}),createAdditionalRequest:async(a,b,c)=>d("/requests/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:a,category:"ADDITIONAL",notes:b,additional_items:c})}),async createFabricationRequest(a,d,e,f){let g=new FormData;g.append("team_id",a),g.append("category","FABRICATION"),g.append("notes",d),g.append("fabrication",JSON.stringify(e)),f&&g.append("file",f);let h=b.authService.getAccessToken(),i=new Headers;h&&i.set("Authorization",`Bearer ${h}`);let j=await fetch(`${c}/requests/`,{method:"POST",headers:i,body:g});if(!j.ok){let a=await j.json().catch(()=>({}));throw Error(a.detail||a.message||`API Error: ${j.status}`)}return j.json()},changeRequestStatus:async(a,b,c)=>d(`/requests/${a}/change_status/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_status:b,note:c||""})}),async listTeamRequests(a,b){let c=new URLSearchParams;return b?.category&&c.append("category",b.category),b?.status&&c.append("status",b.status),b?.fab_type&&c.append("fab_type",b.fab_type),b?.search&&c.append("search",b.search),b?.ordering&&c.append("ordering",b.ordering),b?.page&&c.append("page",b.page.toString()),b?.page_size&&c.append("page_size",b.page_size.toString()),d(`/teams/${a}/requests/${c.toString()?`?${c.toString()}`:""}`)}}])},93107,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=["Submitted","Processing","Issued"];function e({status:a}){return(0,b.jsx)("div",{className:"flex items-center gap-2","aria-label":"Request status progress",children:d.map((e,f)=>{let g=d.indexOf(a),h=g>=f;return(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsxs)("div",{className:`flex flex-col items-center text-[10px] font-medium ${h?"text-[#002449]":"text-gray-400"}`,children:[(0,b.jsx)("div",{className:`h-2.5 w-2.5 rounded-full ${h?g===f?"bg-[#f75700]":"bg-[#002449]":"bg-gray-300"}`}),(0,b.jsx)("span",{className:"mt-1 tracking-wide",children:e})]}),f<d.length-1&&(0,b.jsx)("div",{className:`h-px w-6 ${g>f?"bg-[#002449]":"bg-gray-300"}`,"aria-hidden":"true"})]},e)})})}a.s(["RequestProgress",()=>e])},80080,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(11634),f=a.i(84120),g=a.i(93107);function h(){var a;let h=(0,d.useRouter)(),l=(0,d.useParams)().id,[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(!0),[q,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(!1),u=e.authService.getCurrentUser();(0,c.useEffect)(()=>{if(!e.authService.getAccessToken())return void h.push("/login")},[h]),(0,c.useEffect)(()=>{(async()=>{try{p(!0);let a=await f.requestsService.getRequest(Number.parseInt(l));n(a)}catch(a){console.error("[v0] Error fetching request:",a),r(a instanceof Error?a.message:"Failed to load request")}finally{p(!1)}})()},[l]);let v=async a=>{if(m)try{t(!0);let b=await f.requestsService.changeRequestStatus(m.id,a);n(b)}catch(a){r(a instanceof Error?a.message:"Failed to update status")}finally{t(!1)}};if(o)return(0,b.jsx)("div",{className:"min-h-[40vh] flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-10 h-10 border-4 border-gray-300 border-t-[#f75700] rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading request..."})]})});if(!m)return(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{className:"text-gray-600 text-sm",children:q||"Request not found"})});let w=u?.is_poc||u?.is_admin,x="Submitted"===m.status?["Processing","Cannot be Processed"]:"Processing"===m.status?["Issued","Cannot be Processed"]:[];return(0,b.jsxs)("div",{className:"max-w-5xl mx-auto",children:[q&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,b.jsx)("p",{className:"text-red-800 text-sm",children:q})}),(0,b.jsxs)("div",{className:"group relative bg-white border border-gray-200 rounded-xl p-6 md:p-8 shadow-sm",style:{boxShadow:`inset 0 0 0 2px ${i(m.status)}20`},children:[(0,b.jsx)("span",{className:"absolute inset-y-0 left-0 w-1 rounded-l-xl",style:{backgroundColor:i(m.status)}}),(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row items-start justify-between gap-6 lg:gap-10 mb-6",children:[(0,b.jsxs)("div",{className:"space-y-3 md:space-y-4 flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,b.jsx)("span",{className:"px-3 py-1 text-xs font-semibold text-white rounded-md",style:{backgroundColor:"BOM"===(a=m.category)?"#002449":"ADDITIONAL"===a?"#007367":"#f75700"},children:m.category}),(0,b.jsx)(g.RequestProgress,{status:m.status})]}),(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900 tracking-tight line-clamp-3",children:m.notes||"Request"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-[11px] md:text-xs w-full lg:w-auto lg:min-w-[24rem]",children:[(0,b.jsx)(j,{label:"Created",value:new Date(m.created_at).toLocaleString()}),(0,b.jsx)(j,{label:"Updated",value:new Date(m.updated_at).toLocaleString()}),(0,b.jsx)(j,{label:"Status",value:m.status}),m.position&&(0,b.jsx)(j,{label:"Queue",value:"#"+m.position})]})]}),m.bom_items&&m.bom_items.length>0&&(0,b.jsx)(k,{title:"BOM Items",children:(0,b.jsxs)("table",{className:"w-full text-sm table-fixed",children:[(0,b.jsx)("thead",{className:"bg-gray-50 border border-gray-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-3 py-2 text-left font-semibold",children:"Item Name"}),(0,b.jsx)("th",{className:"px-3 py-2 text-right font-semibold",children:"Qty"})]})}),(0,b.jsx)("tbody",{children:m.bom_items.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-3 py-2",children:a.item_name}),(0,b.jsx)("td",{className:"px-3 py-2 text-right font-semibold",children:a.quantity})]},c))})]})}),m.additional_items&&m.additional_items.length>0&&(0,b.jsx)(k,{title:"Additional Items",children:(0,b.jsxs)("table",{className:"w-full text-sm table-fixed",children:[(0,b.jsx)("thead",{className:"bg-gray-50 border border-gray-200",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-3 py-2 text-left font-semibold",children:"Item Name"}),(0,b.jsx)("th",{className:"px-3 py-2 text-right font-semibold",children:"Qty"})]})}),(0,b.jsx)("tbody",{children:m.additional_items.map((a,c)=>(0,b.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,b.jsx)("td",{className:"px-3 py-2",children:a.item_name}),(0,b.jsx)("td",{className:"px-3 py-2 text-right font-semibold",children:a.quantity})]},c))})]})}),m.fabrication&&(0,b.jsxs)(k,{title:"Fabrication Details",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,b.jsx)(j,{label:"Type",value:m.fabrication.fab_type}),(0,b.jsx)(j,{label:"Name",value:m.fabrication.name})]}),m.fabrication.file&&(0,b.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,b.jsx)("a",{href:m.fabrication.file,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1.5 rounded-md border border-gray-300 text-xs font-medium text-[#002449] hover:bg-gray-50",children:"Download File â†’"})})]}),w&&x.length>0&&(0,b.jsxs)("div",{className:"pt-6 mt-6 border-t border-gray-200",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold mb-4",style:{color:"#f75700"},children:"Update Status"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(a=>(0,b.jsx)("button",{onClick:()=>v(a),disabled:s,className:"px-4 py-2 text-xs font-semibold rounded-md text-white",style:{backgroundColor:"Cannot be Processed"===a?"#f75700":"#078e31"},children:s?"Updating...":"Cannot be Processed"===a?"Reject":"Mark "+a},a))})]})]})]})}function i(a){return"Submitted"===a?"#f75700":"Processing"===a?"#002449":"Issued"===a?"#078e31":"#6b7280"}function j({label:a,value:c}){return(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-[10px] uppercase tracking-wide text-gray-500 font-medium",children:a}),(0,b.jsx)("p",{className:"text-xs font-semibold text-gray-900 truncate whitespace-nowrap max-w-[12rem]",title:c,children:c})]})}function k({title:a,children:c}){return(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h2",{className:"text-sm font-semibold mb-3",style:{color:"#002449"},children:a}),(0,b.jsx)("div",{className:"rounded-lg border border-gray-200 bg-white overflow-hidden p-2 md:p-3",children:c})]})}a.s(["default",()=>h])}];

//# sourceMappingURL=_81b05eb5._.js.map